<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>羽毛球极速记分板 - 专业版</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #6839E8;
            --secondary-color: #0133A4;
            --accent-color: #27F05C;
            --highlight-color: #27F05C;
            --success-color: #27F05C;
            --warning-color: #FFB800;
            --light-color: #FFFFFF;
            --glass-bg: rgba(255, 255, 255, 0.92);
            --glass-border: rgba(104, 57, 232, 0.15);
            --shadow-sm: 0 4px 12px rgba(104, 57, 232, 0.08);
            --shadow-md: 0 8px 30px rgba(104, 57, 232, 0.12);
            --shadow-lg: 0 16px 50px rgba(104, 57, 232, 0.18);
            --shadow-xl: 0 24px 80px rgba(104, 57, 232, 0.25);
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 28px;
            --radius-xl: 40px;
            --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --bg-gradient-1: #D4C8FF;
            --bg-gradient-2: #B8A9FF;
            --bg-gradient-3: #A894FF;
        }

        [data-theme="orange"] {
            --primary-color: #FF6B35;
            --secondary-color: #D63031;
            --accent-color: #FDCB6E;
            --highlight-color: #FDCB6E;
            --success-color: #00B894;
            --warning-color: #FFEAA7;
            --glass-border: rgba(255, 107, 53, 0.15);
            --shadow-sm: 0 4px 12px rgba(255, 107, 53, 0.08);
            --shadow-md: 0 8px 30px rgba(255, 107, 53, 0.12);
            --shadow-lg: 0 16px 50px rgba(255, 107, 53, 0.18);
            --shadow-xl: 0 24px 80px rgba(255, 107, 53, 0.25);
            --bg-gradient-1: #FFE8D6;
            --bg-gradient-2: #FFD4B8;
            --bg-gradient-3: #FFB894;
        }

        [data-theme="blue"] {
            --primary-color: #0984E3;
            --secondary-color: #0066CC;
            --accent-color: #00CEC9;
            --highlight-color: #00CEC9;
            --success-color: #00CEC9;
            --warning-color: #FDCB6E;
            --glass-border: rgba(9, 132, 227, 0.15);
            --shadow-sm: 0 4px 12px rgba(9, 132, 227, 0.08);
            --shadow-md: 0 8px 30px rgba(9, 132, 227, 0.12);
            --shadow-lg: 0 16px 50px rgba(9, 132, 227, 0.18);
            --shadow-xl: 0 24px 80px rgba(9, 132, 227, 0.25);
            --bg-gradient-1: #D4F1FF;
            --bg-gradient-2: #B8E3FF;
            --bg-gradient-3: #94D2FF;
        }

        [data-theme="green"] {
            --primary-color: #00B894;
            --secondary-color: #009432;
            --accent-color: #55EFC4;
            --highlight-color: #55EFC4;
            --success-color: #55EFC4;
            --warning-color: #FFEAA7;
            --glass-border: rgba(0, 184, 148, 0.15);
            --shadow-sm: 0 4px 12px rgba(0, 184, 148, 0.08);
            --shadow-md: 0 8px 30px rgba(0, 184, 148, 0.12);
            --shadow-lg: 0 16px 50px rgba(0, 184, 148, 0.18);
            --shadow-xl: 0 24px 80px rgba(0, 184, 148, 0.25);
            --bg-gradient-1: #D4FFED;
            --bg-gradient-2: #B8FFE0;
            --bg-gradient-3: #94FFD0;
        }

        [data-theme="pink"] {
            --primary-color: #E84393;
            --secondary-color: #C44569;
            --accent-color: #FD79A8;
            --highlight-color: #FD79A8;
            --success-color: #00B894;
            --warning-color: #FDCB6E;
            --glass-border: rgba(232, 67, 147, 0.15);
            --shadow-sm: 0 4px 12px rgba(232, 67, 147, 0.08);
            --shadow-md: 0 8px 30px rgba(232, 67, 147, 0.12);
            --shadow-lg: 0 16px 50px rgba(232, 67, 147, 0.18);
            --shadow-xl: 0 24px 80px rgba(232, 67, 147, 0.25);
            --bg-gradient-1: #FFD4E8;
            --bg-gradient-2: #FFB8D8;
            --bg-gradient-3: #FF94C8;
        }

        [data-theme="blackgold"] {
            --primary-color: #FDCB6E;
            --secondary-color: #D4A418;
            --accent-color: #FFEAA7;
            --highlight-color: #FDCB6E;
            --success-color: #00B894;
            --warning-color: #E17055;
            --light-color: #FFFFFF;
            --glass-bg: rgba(30, 30, 30, 0.95);
            --glass-border: rgba(253, 203, 110, 0.3);
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 8px 30px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 16px 50px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 24px 80px rgba(0, 0, 0, 0.6);
            --bg-gradient-1: #1A1A1A;
            --bg-gradient-2: #2D2D2D;
            --bg-gradient-3: #404040;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        *::-webkit-scrollbar {
            display: none;
        }

        html, body {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        html::-webkit-scrollbar,
        body::-webkit-scrollbar {
            display: none;
        }

        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap');

        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(180deg, var(--bg-gradient-1) 0%, var(--bg-gradient-2) 50%, var(--bg-gradient-3) 100%);
            background-attachment: fixed;
            color: var(--primary-color);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 15% 85%, rgba(104, 57, 232, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 85% 15%, rgba(39, 240, 92, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(1, 51, 164, 0.08) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 0.6s ease;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: 2.8rem;
            font-weight: 900;
            margin-bottom: 10px;
            color: #000000;
            text-shadow: 0 2px 20px rgba(104, 57, 232, 0.15);
            letter-spacing: 1px;
            position: relative;
            display: inline-block;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 8px;
            background: #27F05C;
            border-radius: 4px;
            transform: skewX(-12deg);
        }

        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--highlight-color), #ff6b9d);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
            vertical-align: middle;
        }

        footer {
            text-align: center;
            padding: 24px 20px;
            margin-top: 20px;
        }

        .footer-content {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(104, 57, 232, 0.1);
            border-radius: 20px;
        }

        .footer-logo {
            font-size: 1rem;
        }

        .footer-text {
            font-size: 0.85rem;
            font-weight: 600;
            color: #6839E8;
        }

        .footer-divider {
            color: #6839E8;
            opacity: 0.4;
        }

        .footer-author {
            font-size: 0.85rem;
            font-weight: 700;
            color: #0133A4;
        }

        .screen {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 页面切换动画增强 */
        .screen.fade-out {
            animation: fadeOut 0.2s ease forwards;
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* 空状态优化 */
        .empty-state-enhanced {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state-icon-animated {
            font-size: 5rem;
            margin-bottom: 24px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-8px) rotate(5deg); }
            75% { transform: translateY(-8px) rotate(-5deg); }
        }

        .empty-state-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #0133A4;
            margin-bottom: 12px;
        }

        .empty-state-desc {
            font-size: 0.95rem;
            color: #6839E8;
            opacity: 0.7;
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .empty-state-action {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            color: white;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 1rem;
        }

        .empty-state-action:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(104, 57, 232, 0.35);
        }

        /* 骨架屏加载效果 */
        .skeleton {
            background: linear-gradient(90deg, #F0EBFF 25%, #E8E0FF 50%, #F0EBFF 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            height: 100px;
            margin-bottom: 12px;
        }

        .skeleton-text {
            height: 16px;
            margin-bottom: 8px;
        }

        .skeleton-text.short {
            width: 60%;
        }

        /* 加载动画 */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(104, 57, 232, 0.2);
            border-top-color: #6839E8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ==================== 记分板样式 ==================== */
        .scoreboard-wrapper {
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 50%, #6839E8 100%);
            border-radius: var(--radius-xl);
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(104, 57, 232, 0.4);
        }

        .scoreboard-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #27F05C, #FFD700, #FF6B6B, #27F05C);
            background-size: 200% 100%;
            animation: gradientMove 3s linear infinite;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .scoreboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }

        .timer-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .timer-icon {
            font-size: 1.2rem;
        }

        .timer-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
            font-family: 'Courier New', monospace;
        }

        .game-indicator {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            color: white;
            font-size: 1rem;
        }

        .games-score-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .score-badge {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
        }

        .score-separator {
            color: rgba(255, 255, 255, 0.5);
            font-weight: 700;
        }

        .scoreboard-main {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
        }

        @media (max-width: 600px) {
            .scoreboard-main {
                flex-direction: column;
                gap: 16px;
            }
        }

        .team-section {
            flex: 1;
            text-align: center;
            max-width: 280px;
        }

        .team-header {
            margin-bottom: 16px;
        }

        .team-avatar {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin: 0 auto 10px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .team-avatar:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.3);
        }

        .team-name-wrapper {
            margin-bottom: 8px;
        }

        .team-name-input {
            background: transparent;
            border: none;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
            text-align: center;
            width: 100%;
            padding: 4px 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .team-name-input:focus {
            outline: none;
            border-bottom-color: #27F05C;
        }

        .games-won-dots {
            display: flex;
            justify-content: center;
            gap: 6px;
            min-height: 16px;
        }

        .game-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all var(--transition-fast);
        }

        .game-dot.won {
            background: #27F05C;
            box-shadow: 0 0 10px rgba(39, 240, 92, 0.5);
        }

        .score-circle {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            cursor: pointer;
            transition: all var(--transition-normal);
            border: 4px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }

        .score-circle:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .score-circle:active {
            transform: scale(0.98);
        }

        .score-number {
            font-size: 4rem;
            font-weight: 900;
            color: white;
            line-height: 1;
        }

        .score-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 4px;
        }

        .score-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .score-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            font-size: 1.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .score-btn.plus {
            background: #27F05C;
            color: white;
            box-shadow: 0 4px 15px rgba(39, 240, 92, 0.4);
        }

        .score-btn.plus:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(39, 240, 92, 0.5);
        }

        .score-btn.minus {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .score-btn.minus:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .vs-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }

        .vs-text {
            font-size: 1.5rem;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
        }

        .vs-line {
            width: 2px;
            height: 60px;
            background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        @media (max-width: 600px) {
            .vs-section {
                flex-direction: row;
                padding: 0;
            }
            .vs-line {
                width: 60px;
                height: 2px;
                background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.3), transparent);
            }
        }

        /* 移动端计分板优化 */
        @media (max-width: 480px) {
            .scoreboard-wrapper {
                padding: 16px;
                margin-bottom: 20px;
                border-radius: 20px;
            }

            .scoreboard-header {
                padding: 10px 12px;
                margin-bottom: 16px;
                flex-wrap: wrap;
                gap: 8px;
            }

            .timer-icon {
                font-size: 1rem;
            }

            .timer-value {
                font-size: 1.1rem;
            }

            .game-indicator {
                padding: 6px 12px;
                font-size: 0.85rem;
            }

            .score-badge {
                width: 30px;
                height: 30px;
                font-size: 0.95rem;
            }

            .scoreboard-main {
                gap: 12px;
            }

            .team-section {
                max-width: 100%;
            }

            .team-avatar {
                width: 45px;
                height: 45px;
                font-size: 1.4rem;
                margin-bottom: 6px;
            }

            .team-name-input {
                font-size: 1.1rem;
            }

            .games-won-dots {
                gap: 4px;
            }

            .game-dot {
                width: 10px;
                height: 10px;
            }

            .score-circle {
                width: 120px;
                height: 120px;
                margin-bottom: 12px;
                border-width: 3px;
            }

            .score-number {
                font-size: 3rem;
            }

            .score-label {
                font-size: 0.8rem;
            }

            .score-buttons {
                gap: 10px;
            }

            .score-btn {
                width: 48px;
                height: 48px;
                font-size: 1.5rem;
            }

            .vs-text {
                font-size: 1.2rem;
            }

            .game-mode-section {
                margin-bottom: 16px;
            }

            .mode-label {
                font-size: 0.75rem;
                margin-bottom: 8px;
            }

            .game-mode-chips {
                gap: 6px;
            }

            .mode-chip {
                padding: 8px 14px;
                font-size: 0.85rem;
            }

            .control-buttons {
                gap: 8px;
            }

            .control-btn {
                padding: 10px 14px;
                font-size: 0.85rem;
            }

            .control-btn .btn-icon {
                font-size: 1rem;
            }

            .control-btn .btn-text {
                display: none;
            }
        }

        @media (max-width: 360px) {
            .scoreboard-wrapper {
                padding: 12px;
            }

            .score-circle {
                width: 100px;
                height: 100px;
            }

            .score-number {
                font-size: 2.5rem;
            }

            .score-btn {
                width: 42px;
                height: 42px;
                font-size: 1.3rem;
            }

            .mode-chip {
                padding: 6px 10px;
                font-size: 0.8rem;
            }

            .control-btn {
                padding: 8px 12px;
            }
        }

        .game-mode-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .mode-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 10px;
        }

        .game-mode-chips {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .mode-chip {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .mode-chip:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .mode-chip.active {
            background: #27F05C;
            border-color: #27F05C;
            color: #0133A4;
            box-shadow: 0 4px 15px rgba(39, 240, 92, 0.4);
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .control-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .control-btn .btn-icon {
            font-size: 1.1rem;
        }

        .control-btn.primary {
            background: #27F05C;
            color: #0133A4;
            box-shadow: 0 4px 15px rgba(39, 240, 92, 0.4);
        }

        .control-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 240, 92, 0.5);
        }

        .control-btn.secondary {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .control-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .control-btn.warning {
            background: #FFB800;
            color: #0133A4;
        }

        .control-btn.warning:hover {
            background: #e5a700;
            transform: translateY(-2px);
        }

        .score-circle.winner {
            animation: pulse 0.5s ease;
            box-shadow: 0 0 40px rgba(39, 240, 92, 0.6);
            border-color: #27F05C;
            background: rgba(39, 240, 92, 0.25);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .btn {
            padding: 14px 28px;
            font-size: 1rem;
            font-weight: 700;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .btn-primary {
            background: #27F05C;
            color: #000000;
            box-shadow: 0 6px 20px rgba(39, 240, 92, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(39, 240, 92, 0.55);
        }

        .btn-danger {
            background: #FF4D4D;
            color: #FFFFFF;
            box-shadow: 0 6px 20px rgba(255, 77, 77, 0.35);
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(255, 77, 77, 0.5);
        }

        .btn-dark {
            background: rgba(255, 255, 255, 0.15);
            color: #FFFFFF;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-dark:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.25);
        }

        .btn-success {
            background: #27F05C;
            color: #000000;
            box-shadow: 0 6px 20px rgba(39, 240, 92, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(39, 240, 92, 0.55);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .control-panel {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #FFFFFF;
            padding: 40px 55px;
            border-radius: var(--radius-xl);
            box-shadow: 0 20px 80px rgba(104, 57, 232, 0.3);
            z-index: 1000;
            text-align: center;
            animation: popIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
        }

        .notification.show {
            display: block;
        }

        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0.85); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .notification h3 {
            font-size: 1.6rem;
            margin-bottom: 12px;
            color: #6839E8;
            font-weight: 900;
        }

        .notification p {
            color: #0133A4;
            margin-bottom: 20px;
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .input-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #FFFFFF;
            padding: 40px 50px;
            border-radius: var(--radius-xl);
            box-shadow: 0 20px 80px rgba(104, 57, 232, 0.3);
            z-index: 1000;
            text-align: center;
            animation: popIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
            min-width: 340px;
        }

        .input-dialog.show {
            display: block;
        }

        .input-dialog h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: #6839E8;
            font-weight: 900;
        }

        .input-dialog input {
            width: 100%;
            padding: 14px 20px;
            border: 3px solid rgba(104, 57, 232, 0.2);
            border-radius: var(--radius-md);
            background: rgba(104, 57, 232, 0.03);
            font-size: 1.05rem;
            color: #0133A4;
            margin-bottom: 24px;
            outline: none;
            transition: all var(--transition-normal);
            font-weight: 500;
        }

        .input-dialog input:focus {
            border-color: #6839E8;
            background: rgba(104, 57, 232, 0.08);
            box-shadow: 0 0 0 4px rgba(104, 57, 232, 0.1);
        }

        .input-dialog-buttons {
            display: flex;
            justify-content: center;
            gap: 16px;
        }

        .result-card {
            background: #FFFFFF;
            border-radius: var(--radius-xl);
            box-shadow: 0 16px 50px rgba(104, 57, 232, 0.2);
            padding: 40px;
            text-align: center;
            margin-top: 30px;
            animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .result-card .btn-dark {
            background: #6839E8;
            color: #FFFFFF;
            border: 2px solid #6839E8;
        }

        .result-card .btn-dark:hover {
            background: #5a2fd1;
            border-color: #5a2fd1;
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.92); }
            to { opacity: 1; transform: scale(1); }
        }

        .result-title {
            font-size: 1.7rem;
            font-weight: 900;
            margin-bottom: 22px;
            color: #6839E8;
        }

        .result-score {
            font-size: 3.8rem;
            font-weight: 900;
            margin: 22px 0;
            color: #27F05C;
        }

        .grouping-container, .expense-tracker, .history-container, .settings-container {
            padding: 20px;
        }

        /* ==================== 历史记录样式 ==================== */
        .history-wrapper {
            padding: 20px;
        }

        .history-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .stats-overview {
            margin-bottom: 24px;
        }

        .stats-summary-card {
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            border-radius: var(--radius-xl);
            padding: 30px;
            color: white;
            box-shadow: 0 12px 40px rgba(104, 57, 232, 0.3);
        }

        .stats-summary-main {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stats-big-number {
            font-size: 4rem;
            font-weight: 900;
            line-height: 1;
        }

        .stats-big-label {
            font-size: 1.1rem;
            opacity: 0.8;
            margin-top: 8px;
        }

        .stats-summary-details {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        @media (max-width: 600px) {
            .stats-summary-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stats-detail-item {
            text-align: center;
        }

        .detail-value {
            display: block;
            font-size: 1.5rem;
            font-weight: 800;
        }

        .detail-label {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .charts-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-md);
        }

        .chart-title {
            font-size: 1rem;
            font-weight: 700;
            color: #0133A4;
            margin-bottom: 16px;
        }

        .chart-canvas-container {
            position: relative;
            height: 200px;
        }

        .history-actions-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .history-list-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-md);
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(104, 57, 232, 0.1);
        }

        .list-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #0133A4;
        }

        .list-count {
            font-size: 0.9rem;
            color: #6839E8;
            font-weight: 600;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .history-card {
            background: #FAFAFF;
            border-radius: var(--radius-md);
            padding: 16px;
            border-left: 4px solid #6839E8;
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .history-card:hover {
            background: #F0EBFF;
            transform: translateX(4px);
        }

        .history-card.win {
            border-left-color: #27F05C;
        }

        .history-card.lose {
            border-left-color: #FF4D4D;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .history-date {
            font-size: 0.85rem;
            color: #6839E8;
            opacity: 0.7;
        }

        .history-result {
            font-size: 1.1rem;
            font-weight: 800;
            color: #0133A4;
        }

        .history-players {
            font-size: 1rem;
            color: #0133A4;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .history-meta {
            display: flex;
            gap: 16px;
            font-size: 0.85rem;
            color: #6839E8;
            opacity: 0.7;
        }

        .history-highlight-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .history-highlight-tag {
            background: linear-gradient(135deg, #F0EBFF 0%, #E8E0FF 100%);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #6839E8;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6839E8;
            opacity: 0.6;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .empty-state-hint {
            font-size: 0.85rem;
            margin-top: 8px;
        }

        /* 比赛详情模态框 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10002;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .match-detail-modal {
            background: white;
            border-radius: 24px;
            max-width: 400px;
            width: 100%;
            animation: scaleIn 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .match-detail-modal .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            color: white;
        }

        .match-detail-modal .detail-header h3 {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .match-detail-modal .detail-content {
            padding: 24px;
        }

        .detail-teams {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(104, 57, 232, 0.1);
        }

        .detail-team {
            text-align: center;
            flex: 1;
        }

        .detail-team .team-label {
            font-size: 0.9rem;
            color: #0133A4;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .detail-team .team-score {
            font-size: 2.5rem;
            font-weight: 900;
            color: #6839E8;
        }

        .detail-team.winner .team-score {
            color: #27F05C;
        }

        .detail-vs {
            font-size: 1rem;
            font-weight: 700;
            color: #6839E8;
            opacity: 0.5;
        }

        .detail-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: #FAFAFF;
            border-radius: var(--radius-sm);
        }

        .info-label {
            font-size: 0.9rem;
            color: #6839E8;
        }

        .info-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #0133A4;
        }

        .detail-highlights {
            margin-bottom: 20px;
        }

        .highlights-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: #0133A4;
            margin-bottom: 12px;
        }

        .highlights-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .highlight-tag {
            background: linear-gradient(135deg, #F0EBFF 0%, #E8E0FF 100%);
            padding: 6px 14px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #6839E8;
        }

        .detail-actions {
            display: flex;
            justify-content: center;
        }

        .detail-actions .btn {
            background: #6839E8;
            color: white;
            border: none;
        }

        .detail-actions .btn:hover {
            background: #5a2fd1;
        }

        /* ==================== 排行榜样式 ==================== */
        .leaderboard-wrapper {
            padding: 20px;
        }

        .leaderboard-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .leaderboard-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 12px 20px;
            background: white;
            border: 2px solid rgba(104, 57, 232, 0.15);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .tab-item:hover {
            border-color: rgba(104, 57, 232, 0.3);
            background: #F5F0FF;
        }

        .tab-item.active {
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 15px rgba(104, 57, 232, 0.3);
        }

        .tab-icon {
            font-size: 1.1rem;
        }

        .tab-text {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .leaderboard-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .top-three-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        @media (max-width: 600px) {
            .top-three-section {
                grid-template-columns: 1fr;
            }
        }

        .top-player-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .top-player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .top-player-card.gold::before {
            background: linear-gradient(90deg, #FFD700, #FFA500);
        }

        .top-player-card.silver::before {
            background: linear-gradient(90deg, #C0C0C0, #A8A8A8);
        }

        .top-player-card.bronze::before {
            background: linear-gradient(90deg, #CD7F32, #8B4513);
        }

        .top-rank-badge {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 12px;
        }

        .top-player-card.gold .top-rank-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }

        .top-player-card.silver .top-rank-badge {
            background: linear-gradient(135deg, #C0C0C0, #A8A8A8);
        }

        .top-player-card.bronze .top-rank-badge {
            background: linear-gradient(135deg, #CD7F32, #8B4513);
        }

        .top-player-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: #0133A4;
            margin-bottom: 8px;
        }

        .top-player-value {
            font-size: 1.8rem;
            font-weight: 900;
            color: #6839E8;
        }

        .top-player-stats {
            font-size: 0.85rem;
            color: #6839E8;
            opacity: 0.7;
            margin-top: 4px;
        }

        .leaderboard-list-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-md);
        }

        .leaderboard-list-section .list-header {
            display: grid;
            grid-template-columns: 60px 1fr 100px;
            padding: 12px 16px;
            background: #FAFAFF;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 600;
            color: #6839E8;
            margin-bottom: 12px;
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .leaderboard-item {
            display: grid;
            grid-template-columns: 60px 1fr 100px;
            align-items: center;
            padding: 14px 16px;
            background: #FAFAFF;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }

        .leaderboard-item:hover {
            background: #F0EBFF;
            transform: translateX(4px);
        }

        .leaderboard-rank {
            font-weight: 800;
            font-size: 1.1rem;
            color: #6839E8;
        }

        .leaderboard-rank.rank-1 {
            color: #FFD700;
        }

        .leaderboard-rank.rank-2 {
            color: #C0C0C0;
        }

        .leaderboard-rank.rank-3 {
            color: #CD7F32;
        }

        .leaderboard-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-avatar-small {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .leaderboard-name {
            font-weight: 600;
            color: #0133A4;
        }

        .leaderboard-value {
            font-weight: 800;
            font-size: 1.1rem;
            color: #6839E8;
            text-align: right;
        }

        /* ==================== 成就系统样式 ==================== */
        .achievements-wrapper {
            padding: 20px;
        }

        .achievements-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .achievements-progress-card {
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            border-radius: var(--radius-xl);
            padding: 30px;
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 24px;
            box-shadow: 0 12px 40px rgba(104, 57, 232, 0.3);
        }

        @media (max-width: 600px) {
            .achievements-progress-card {
                flex-direction: column;
                text-align: center;
            }
        }

        .progress-ring {
            position: relative;
            width: 120px;
            height: 120px;
            flex-shrink: 0;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
        }

        .progress-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.2);
            stroke-width: 8;
        }

        .progress-bar {
            fill: none;
            stroke: #27F05C;
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 0.5s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }

        .progress-value {
            display: block;
            font-size: 1.5rem;
            font-weight: 800;
        }

        .progress-label {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .progress-stats {
            display: flex;
            gap: 30px;
        }

        .progress-stat {
            text-align: center;
            color: white;
        }

        .stat-num {
            display: block;
            font-size: 2rem;
            font-weight: 800;
        }

        .stat-text {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .achievements-categories {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .achievement-category {
            background: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-md);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(104, 57, 232, 0.1);
        }

        .category-icon {
            font-size: 1.3rem;
        }

        .category-title {
            font-size: 1rem;
            font-weight: 700;
            color: #0133A4;
        }

        .category-achievements {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }

        .achievement-card {
            background: #FAFAFF;
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
            border: 2px solid transparent;
            transition: all var(--transition-fast);
        }

        .achievement-card.unlocked {
            border-color: #27F05C;
            background: linear-gradient(135deg, rgba(39, 240, 92, 0.1) 0%, rgba(39, 240, 92, 0.05) 100%);
        }

        .achievement-card.locked {
            opacity: 0.6;
        }

        .achievement-card-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .achievement-card-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: #0133A4;
            margin-bottom: 4px;
        }

        .achievement-card-desc {
            font-size: 0.8rem;
            color: #6839E8;
            opacity: 0.7;
        }

        .achievement-card.unlocked .achievement-card-icon {
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* ==================== 设置页面样式 ==================== */
        .settings-wrapper {
            padding: 20px;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .settings-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .settings-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-md);
        }

        .settings-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(104, 57, 232, 0.1);
        }

        .card-icon {
            font-size: 1.3rem;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 700;
            color: #0133A4;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
        }

        .theme-card {
            background: #FAFAFF;
            border-radius: var(--radius-md);
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--transition-fast);
        }

        .theme-card:hover {
            border-color: rgba(104, 57, 232, 0.3);
        }

        .theme-card.active {
            border-color: #27F05C;
            background: linear-gradient(135deg, rgba(39, 240, 92, 0.1) 0%, rgba(39, 240, 92, 0.05) 100%);
        }

        .theme-preview {
            width: 100%;
            height: 40px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .theme-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .theme-emoji {
            font-size: 1rem;
        }

        .theme-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: #0133A4;
        }

        .settings-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #FAFAFF;
            border-radius: var(--radius-sm);
        }

        .setting-info {
            flex: 1;
        }

        .setting-label {
            display: block;
            font-weight: 600;
            color: #0133A4;
            font-size: 0.95rem;
        }

        .setting-desc {
            display: block;
            font-size: 0.8rem;
            color: #6839E8;
            opacity: 0.7;
            margin-top: 2px;
        }

        .setting-input {
            width: 70px;
            padding: 8px 12px;
            border: 2px solid rgba(104, 57, 232, 0.2);
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            color: #6839E8;
            background: white;
        }

        .setting-input:focus {
            outline: none;
            border-color: #6839E8;
        }

        .avatar-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .avatar-library {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
        }

        .avatar-item {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .avatar-item:hover {
            transform: scale(1.1);
        }

        .data-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .data-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: #FAFAFF;
            border: 2px solid rgba(104, 57, 232, 0.1);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: left;
        }

        .data-btn:hover {
            border-color: rgba(104, 57, 232, 0.3);
            background: #F0EBFF;
        }

        .data-btn .btn-icon {
            font-size: 1.5rem;
        }

        .data-btn .btn-content {
            flex: 1;
        }

        .data-btn .btn-title {
            display: block;
            font-weight: 600;
            color: #0133A4;
            font-size: 0.95rem;
        }

        .data-btn .btn-desc {
            display: block;
            font-size: 0.8rem;
            color: #6839E8;
            opacity: 0.7;
        }

        .data-btn.backup {
            border-left: 4px solid #27F05C;
        }

        .data-btn.restore {
            border-left: 4px solid #6839E8;
        }

        .data-btn.danger {
            border-left: 4px solid #FF4D4D;
        }

        .about-card {
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
        }

        .about-content {
            display: flex;
            align-items: center;
            gap: 16px;
            color: white;
        }

        .about-logo {
            font-size: 3rem;
        }

        .about-name {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .about-version {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .about-author {
            font-size: 0.85rem;
            opacity: 0.6;
        }

        /* ==================== 全局移动端优化 ==================== */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .section-subtitle {
                font-size: 0.85rem;
            }

            .grouping-header,
            .history-header,
            .leaderboard-header,
            .achievements-header,
            .settings-header,
            .ability-header {
                margin-bottom: 20px;
            }

            .grouping-main {
                gap: 20px;
                margin-bottom: 20px;
            }

            .input-section {
                padding: 16px;
            }

            .input-label {
                font-size: 0.9rem;
            }

            .players-textarea {
                min-height: 120px;
                padding: 12px;
                font-size: 0.9rem;
            }

            .btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .btn-small {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 8px;
            }

            .section-title {
                font-size: 1.3rem;
            }

            .section-subtitle {
                font-size: 0.8rem;
            }

            .grouping-main {
                gap: 16px;
                margin-bottom: 16px;
            }

            .input-section {
                padding: 12px;
                border-radius: 16px;
            }

            .input-label {
                font-size: 0.85rem;
                margin-bottom: 8px;
            }

            .label-icon {
                font-size: 1rem;
            }

            .players-textarea {
                min-height: 100px;
                padding: 10px;
                font-size: 0.85rem;
                border-radius: 12px;
            }

            .btn {
                padding: 8px 14px;
                font-size: 0.85rem;
                border-radius: 10px;
            }

            .btn-small {
                padding: 6px 10px;
                font-size: 0.75rem;
            }

            /* 智能分组移动端优化 */
            .grouping-result {
                padding: 12px;
            }

            .team-result {
                padding: 12px;
            }

            .team-label {
                font-size: 0.85rem;
            }

            .team-players {
                font-size: 0.9rem;
            }

            .player-count-badge {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            /* 费用计算移动端优化 */
            .expense-type-card,
            .split-mode-card {
                padding: 12px;
            }

            .expense-type-icon,
            .split-mode-icon {
                font-size: 1.5rem;
            }

            .expense-type-name,
            .split-mode-name {
                font-size: 0.85rem;
            }

            .quick-amount-btn {
                padding: 8px 14px;
                font-size: 0.85rem;
            }

            /* 历史记录移动端优化 */
            .stats-summary-card {
                padding: 20px;
            }

            .stats-big-number {
                font-size: 3rem;
            }

            .stats-summary-details {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .detail-value {
                font-size: 1.2rem;
            }

            .chart-card {
                padding: 14px;
            }

            .chart-canvas-container {
                height: 150px;
            }

            .history-card {
                padding: 12px;
            }

            /* 排行榜移动端优化 */
            .tab-item {
                padding: 8px 12px;
            }

            .tab-icon {
                font-size: 1rem;
            }

            .tab-text {
                font-size: 0.8rem;
            }

            .top-player-card {
                padding: 14px;
            }

            .top-rank-badge {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .top-player-name {
                font-size: 0.95rem;
            }

            .top-player-value {
                font-size: 1.4rem;
            }

            .leaderboard-list-section {
                padding: 14px;
            }

            .leaderboard-list-section .list-header {
                font-size: 0.75rem;
                padding: 10px 12px;
            }

            .leaderboard-item {
                padding: 10px 12px;
            }

            .player-avatar-small {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }

            .leaderboard-name {
                font-size: 0.85rem;
            }

            .leaderboard-value {
                font-size: 0.95rem;
            }

            /* 能力分析移动端优化 */
            .player-info-card {
                padding: 20px;
            }

            .player-avatar {
                width: 60px;
                height: 60px;
                font-size: 2rem;
            }

            .player-name-display {
                font-size: 1.4rem;
            }

            .ability-stats-section,
            .ability-rank-section,
            .ability-trend-section,
            .ability-tags-section {
                padding: 14px;
            }

            .ability-stat-card {
                padding: 12px;
            }

            .ability-stat-value {
                font-size: 1.5rem;
            }

            .ability-stat-label {
                font-size: 0.75rem;
            }

            .rank-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            .recent-match-item {
                padding: 10px 12px;
            }

            .ability-tag {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            /* 成就系统移动端优化 */
            .achievements-progress-card {
                padding: 20px;
                gap: 20px;
            }

            .progress-ring {
                width: 100px;
                height: 100px;
            }

            .progress-value {
                font-size: 1.2rem;
            }

            .stat-num {
                font-size: 1.5rem;
            }

            .achievement-category {
                padding: 14px;
            }

            .category-achievements {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .achievement-card {
                padding: 12px;
            }

            .achievement-card-icon {
                font-size: 1.5rem;
            }

            .achievement-card-title {
                font-size: 0.85rem;
            }

            .achievement-card-desc {
                font-size: 0.7rem;
            }

            /* 设置页面移动端优化 */
            .settings-card {
                padding: 14px;
            }

            .theme-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            .theme-card {
                padding: 10px;
            }

            .theme-preview {
                height: 30px;
            }

            .theme-emoji {
                font-size: 0.85rem;
            }

            .theme-name {
                font-size: 0.7rem;
            }

            .setting-row {
                padding: 10px 12px;
            }

            .setting-label {
                font-size: 0.85rem;
            }

            .setting-desc {
                font-size: 0.7rem;
            }

            .setting-input {
                width: 60px;
                padding: 6px 10px;
                font-size: 0.9rem;
            }

            .data-btn {
                padding: 12px 14px;
            }

            .data-btn .btn-icon {
                font-size: 1.3rem;
            }

            .data-btn .btn-title {
                font-size: 0.85rem;
            }

            .data-btn .btn-desc {
                font-size: 0.7rem;
            }

            .about-content {
                gap: 12px;
            }

            .about-logo {
                font-size: 2.5rem;
            }

            .about-name {
                font-size: 1rem;
            }

            .about-version {
                font-size: 0.8rem;
            }

            .about-author {
                font-size: 0.75rem;
            }

            /* Footer移动端优化 */
            .footer-content {
                padding: 8px 14px;
                gap: 6px;
            }

            .footer-logo {
                font-size: 0.85rem;
            }

            .footer-text {
                font-size: 0.75rem;
            }

            .footer-author {
                font-size: 0.75rem;
            }

            /* 模态框移动端优化 */
            .modal-overlay {
                padding: 12px;
            }

            .match-detail-modal {
                border-radius: 20px;
            }

            .match-detail-modal .detail-header {
                padding: 16px;
            }

            .match-detail-modal .detail-content {
                padding: 16px;
            }

            .detail-team .team-score {
                font-size: 2rem;
            }

            .info-item {
                padding: 8px 12px;
            }

            /* 通知弹窗移动端优化 */
            .notification {
                padding: 16px;
                max-width: calc(100% - 24px);
            }
        }

        @media (max-width: 360px) {
            .section-title {
                font-size: 1.1rem;
            }

            .input-section {
                padding: 10px;
            }

            .players-textarea {
                min-height: 80px;
                padding: 8px;
            }

            .category-achievements {
                grid-template-columns: 1fr 1fr;
            }

            .theme-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-summary-details {
                gap: 8px;
            }

            .detail-value {
                font-size: 1rem;
            }

            .rank-cards {
                gap: 8px;
            }

            .rank-card .rank-value {
                font-size: 1.2rem;
            }
        }

        /* ==================== 新手引导样式 ==================== */
        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }

        .onboarding-overlay.fade-out {
            animation: fadeOut 0.3s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .onboarding-modal {
            background: white;
            border-radius: 24px;
            max-width: 400px;
            width: 100%;
            padding: 40px 30px;
            text-align: center;
            animation: scaleIn 0.4s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .onboarding-slides {
            position: relative;
            min-height: 200px;
        }

        .onboarding-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.4s ease;
        }

        .onboarding-slide.active {
            opacity: 1;
            transform: translateX(0);
        }

        .slide-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .slide-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #0133A4;
            margin-bottom: 12px;
        }

        .slide-desc {
            font-size: 1rem;
            color: #6839E8;
            opacity: 0.8;
            line-height: 1.6;
        }

        .onboarding-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 30px 0;
        }

        .onboarding-dots .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(104, 57, 232, 0.2);
            transition: all 0.3s ease;
        }

        .onboarding-dots .dot.active {
            background: #6839E8;
            width: 30px;
            border-radius: 5px;
        }

        .onboarding-actions {
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .btn-skip {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid rgba(104, 57, 232, 0.3);
            border-radius: 12px;
            color: #6839E8;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-skip:hover {
            background: rgba(104, 57, 232, 0.1);
        }

        .btn-next {
            flex: 1;
            padding: 12px 24px;
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(104, 57, 232, 0.3);
        }

        /* ==================== 快捷操作样式 ==================== */
        .quick-actions-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            z-index: 9999;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .quick-actions-panel.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .quick-actions-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
        }

        .quick-action-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px;
            background: #F5F0FF;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-action-item:hover {
            background: #E8E0FF;
            transform: scale(1.05);
        }

        .quick-action-item:active {
            transform: scale(0.95);
        }

        .quick-icon {
            font-size: 2rem;
        }

        .quick-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #0133A4;
        }

        /* 移动端优化 */
        @media (max-width: 480px) {
            .onboarding-modal {
                padding: 30px 20px;
            }

            .slide-icon {
                font-size: 3rem;
            }

            .slide-title {
                font-size: 1.2rem;
            }

            .slide-desc {
                font-size: 0.9rem;
            }

            .quick-actions-content {
                padding: 16px;
                gap: 10px;
            }

            .quick-action-item {
                padding: 16px;
            }

            .quick-icon {
                font-size: 1.5rem;
            }

            .quick-label {
                font-size: 0.75rem;
            }
        }

        .grouping-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: #0133A4;
            margin-bottom: 8px;
        }

        .section-subtitle {
            color: #6839E8;
            font-size: 0.95rem;
            opacity: 0.8;
        }

        .grouping-main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .grouping-main {
                grid-template-columns: 1fr;
            }
        }

        .grouping-left, .grouping-right {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
        }

        .input-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            color: #0133A4;
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .label-icon {
            font-size: 1.2rem;
        }

        .players-textarea {
            width: 100%;
            min-height: 180px;
            padding: 16px;
            font-size: 1rem;
            font-family: inherit;
            border-radius: var(--radius-md);
            border: 2px solid rgba(104, 57, 232, 0.15);
            background: #FAFAFF;
            resize: vertical;
            transition: all var(--transition-normal);
            color: #0133A4;
            font-weight: 500;
            line-height: 1.6;
        }

        .players-textarea:focus {
            outline: none;
            border-color: #6839E8;
            box-shadow: 0 0 0 4px rgba(104, 57, 232, 0.1);
            background: white;
        }

        .player-count-hint {
            text-align: right;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #6839E8;
            font-weight: 600;
        }

        .quick-add-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            box-shadow: var(--shadow-sm);
        }

        .quick-add-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .quick-add-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #F0EBFF 0%, #E8E0FF 100%);
            border: 2px solid rgba(104, 57, 232, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #6839E8;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .quick-add-btn:hover {
            background: #6839E8;
            color: white;
            border-color: #6839E8;
            transform: translateY(-2px);
        }

        .mode-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
        }

        .mode-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        @media (max-width: 600px) {
            .mode-cards {
                grid-template-columns: 1fr;
            }
        }

        .mode-card {
            padding: 16px 12px;
            background: #FAFAFF;
            border: 2px solid rgba(104, 57, 232, 0.1);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .mode-card:hover {
            border-color: rgba(104, 57, 232, 0.3);
            background: #F5F0FF;
        }

        .mode-card.active {
            border-color: #6839E8;
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            box-shadow: 0 4px 15px rgba(104, 57, 232, 0.3);
        }

        .mode-card.active .mode-icon,
        .mode-card.active .mode-name,
        .mode-card.active .mode-desc {
            color: white;
        }

        .mode-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .mode-name {
            font-weight: 700;
            color: #0133A4;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .mode-desc {
            font-size: 0.75rem;
            color: #6839E8;
            opacity: 0.8;
        }

        .skill-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
        }

        .skill-hint {
            font-size: 0.85rem;
            color: #6839E8;
            margin-bottom: 16px;
            opacity: 0.8;
        }

        .skill-inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .skill-input-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: #FAFAFF;
            border-radius: var(--radius-sm);
            border: 2px solid rgba(104, 57, 232, 0.1);
        }

        .skill-input-item .player-name {
            flex: 1;
            font-weight: 600;
            color: #0133A4;
            font-size: 0.9rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .skill-input-item input {
            width: 50px;
            padding: 6px;
            text-align: center;
            border: 2px solid rgba(104, 57, 232, 0.2);
            border-radius: 8px;
            font-weight: 700;
            color: #6839E8;
            background: white;
        }

        .skill-input-item input:focus {
            outline: none;
            border-color: #6839E8;
        }

        .grouping-actions {
            display: flex;
            gap: 12px;
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 1.1rem;
        }

        .btn-icon {
            margin-right: 8px;
        }

        .btn-outline {
            background: white;
            color: #6839E8;
            border: 2px solid rgba(104, 57, 232, 0.3);
        }

        .btn-outline:hover {
            background: #F5F0FF;
            border-color: #6839E8;
        }

        .group-results-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: 30px;
            box-shadow: var(--shadow-lg);
            margin-top: 20px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #0133A4;
        }

        .results-actions {
            display: flex;
            gap: 10px;
        }

        .group-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .group-card {
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            border-radius: var(--radius-lg);
            padding: 24px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(104, 57, 232, 0.25);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .group-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .group-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(104, 57, 232, 0.35);
        }

        .group-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .group-number {
            font-size: 1.5rem;
            font-weight: 900;
            color: white;
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 14px;
            border-radius: 20px;
        }

        .group-skill-badge {
            font-size: 0.8rem;
            color: white;
            background: rgba(255, 255, 255, 0.15);
            padding: 4px 10px;
            border-radius: 12px;
        }

        .group-players {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .group-player {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-sm);
            color: white;
            font-weight: 600;
            font-size: 1rem;
            backdrop-filter: blur(5px);
        }

        .group-player-skill {
            font-size: 0.75rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .group-stats {
            margin-top: 25px;
            padding: 20px;
            background: #FAFAFF;
            border-radius: var(--radius-md);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .group-stat-item {
            text-align: center;
        }

        .group-stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #6839E8;
        }

        .group-stat-label {
            font-size: 0.85rem;
            color: #0133A4;
            opacity: 0.7;
        }

        .grouping-history-section {
            margin-top: 30px;
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
        }

        .grouping-history-section .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .grouping-history-section .history-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #0133A4;
        }

        .grouping-history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .grouping-history-item {
            padding: 16px;
            background: #FAFAFF;
            border-radius: var(--radius-sm);
            border-left: 4px solid #6839E8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .grouping-history-info {
            flex: 1;
        }

        .grouping-history-mode {
            font-weight: 700;
            color: #6839E8;
            margin-bottom: 4px;
        }

        .grouping-history-players {
            font-size: 0.9rem;
            color: #0133A4;
            opacity: 0.8;
        }

        .grouping-history-date {
            font-size: 0.8rem;
            color: #6839E8;
            opacity: 0.6;
        }

        /* ==================== 费用计算样式 ==================== */
        .expense-container {
            padding: 20px;
        }

        .expense-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .expense-main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .expense-main {
                grid-template-columns: 1fr;
            }
        }

        .expense-left, .expense-right {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .expense-type-section, .amount-section, .split-mode-section, .participants-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
        }

        .expense-type-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        @media (max-width: 600px) {
            .expense-type-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .expense-type-card {
            padding: 16px 12px;
            background: #FAFAFF;
            border: 2px solid rgba(104, 57, 232, 0.1);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .expense-type-card:hover {
            border-color: rgba(104, 57, 232, 0.3);
            background: #F5F0FF;
        }

        .expense-type-card.active {
            border-color: #6839E8;
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            box-shadow: 0 4px 15px rgba(104, 57, 232, 0.3);
        }

        .expense-type-card.active .type-icon,
        .expense-type-card.active .type-name {
            color: white;
        }

        .type-icon {
            font-size: 1.8rem;
            margin-bottom: 6px;
        }

        .type-name {
            font-weight: 600;
            color: #0133A4;
            font-size: 0.85rem;
        }

        .amount-input-wrapper {
            display: flex;
            align-items: center;
            background: #FAFAFF;
            border: 2px solid rgba(104, 57, 232, 0.15);
            border-radius: var(--radius-md);
            padding: 4px;
            transition: all var(--transition-fast);
        }

        .amount-input-wrapper:focus-within {
            border-color: #6839E8;
            box-shadow: 0 0 0 4px rgba(104, 57, 232, 0.1);
        }

        .currency-symbol {
            font-size: 1.5rem;
            font-weight: 700;
            color: #6839E8;
            padding: 12px 16px;
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            border-radius: 10px;
            color: white;
        }

        .amount-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 16px;
            font-size: 1.8rem;
            font-weight: 700;
            color: #0133A4;
            text-align: right;
        }

        .amount-input:focus {
            outline: none;
        }

        .amount-input::placeholder {
            color: rgba(1, 51, 164, 0.3);
        }

        .quick-amounts {
            display: flex;
            gap: 10px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .quick-amount-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #F0EBFF 0%, #E8E0FF 100%);
            border: 2px solid rgba(104, 57, 232, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #6839E8;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .quick-amount-btn:hover {
            background: #6839E8;
            color: white;
            border-color: #6839E8;
            transform: translateY(-2px);
        }

        .split-mode-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        @media (max-width: 600px) {
            .split-mode-cards {
                grid-template-columns: 1fr;
            }
        }

        .split-mode-card {
            padding: 14px 10px;
            background: #FAFAFF;
            border: 2px solid rgba(104, 57, 232, 0.1);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .split-mode-card:hover {
            border-color: rgba(104, 57, 232, 0.3);
            background: #F5F0FF;
        }

        .split-mode-card.active {
            border-color: #6839E8;
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            box-shadow: 0 4px 15px rgba(104, 57, 232, 0.3);
        }

        .split-mode-card.active .mode-icon,
        .split-mode-card.active .mode-name,
        .split-mode-card.active .mode-desc {
            color: white;
        }

        .participants-textarea {
            width: 100%;
            min-height: 100px;
            padding: 14px;
            font-size: 1rem;
            font-family: inherit;
            border-radius: var(--radius-md);
            border: 2px solid rgba(104, 57, 232, 0.15);
            background: #FAFAFF;
            resize: vertical;
            transition: all var(--transition-normal);
            color: #0133A4;
            font-weight: 500;
            line-height: 1.6;
        }

        .participants-textarea:focus {
            outline: none;
            border-color: #6839E8;
            box-shadow: 0 0 0 4px rgba(104, 57, 232, 0.1);
            background: white;
        }

        .participant-count-hint {
            text-align: right;
            margin-top: 8px;
            font-size: 0.85rem;
            color: #6839E8;
            font-weight: 600;
        }

        .custom-ratio-container {
            margin-top: 16px;
            padding: 16px;
            background: #FAFAFF;
            border-radius: var(--radius-md);
        }

        .ratio-inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .ratio-input-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border-radius: var(--radius-sm);
            border: 2px solid rgba(104, 57, 232, 0.1);
        }

        .ratio-input-item .player-name {
            flex: 1;
            font-weight: 600;
            color: #0133A4;
            font-size: 0.85rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .ratio-input-item input {
            width: 50px;
            padding: 6px;
            text-align: center;
            border: 2px solid rgba(104, 57, 232, 0.2);
            border-radius: 8px;
            font-weight: 700;
            color: #6839E8;
            background: white;
        }

        .expense-actions {
            display: flex;
            gap: 12px;
        }

        .expense-result-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: 30px;
            box-shadow: var(--shadow-lg);
            margin-top: 20px;
        }

        .expense-summary-card {
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            border-radius: var(--radius-lg);
            padding: 24px;
            color: white;
            margin-bottom: 20px;
        }

        .expense-summary-card .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .expense-summary-card .summary-row:last-child {
            border-bottom: none;
        }

        .expense-summary-card .summary-label {
            opacity: 0.8;
            font-size: 0.95rem;
        }

        .expense-summary-card .summary-value {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .expense-summary-card .summary-total {
            font-size: 1.5rem;
        }

        .expense-details-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
        }

        .expense-detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            background: #FAFAFF;
            border-radius: var(--radius-md);
            border-left: 4px solid #6839E8;
        }

        .expense-detail-item .detail-name {
            font-weight: 600;
            color: #0133A4;
        }

        .expense-detail-item .detail-amount {
            font-weight: 700;
            color: #6839E8;
            font-size: 1.1rem;
        }

        .expense-history-section {
            margin-top: 30px;
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
        }

        .expense-history-section .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .expense-history-section .history-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #0133A4;
        }

        .expense-history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .expense-history-item {
            padding: 16px;
            background: #FAFAFF;
            border-radius: var(--radius-sm);
            border-left: 4px solid #27F05C;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .expense-history-info {
            flex: 1;
        }

        .expense-history-type {
            font-weight: 700;
            color: #6839E8;
            margin-bottom: 4px;
        }

        .expense-history-amount {
            font-size: 0.9rem;
            color: #0133A4;
            opacity: 0.8;
        }

        .expense-history-date {
            font-size: 0.8rem;
            color: #6839E8;
            opacity: 0.6;
        }

        .expense-history-item {
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .expense-history-item:hover {
            background: #F0EBFF;
            transform: translateX(4px);
        }

        /* 费用详情模态框 */
        .expense-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .expense-detail-modal.show {
            display: flex;
        }

        .expense-detail-wrapper {
            background: white;
            border-radius: 24px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            animation: scaleIn 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .detail-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .detail-modal-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #0133A4;
        }

        .detail-close-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: #F5F0FF;
            color: #6839E8;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .detail-close-btn:hover {
            background: #6839E8;
            color: white;
        }

        /* ==================== 选手能力分析样式 ==================== */
        .ability-container {
            padding: 20px;
        }

        .ability-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .ability-main {
            max-width: 800px;
            margin: 0 auto;
        }

        .player-selector-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
            margin-bottom: 24px;
        }

        .player-select {
            width: 100%;
            padding: 14px 18px;
            font-size: 1.1rem;
            font-weight: 600;
            border: 2px solid rgba(104, 57, 232, 0.15);
            border-radius: var(--radius-md);
            background: #FAFAFF;
            color: #0133A4;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .player-select:focus {
            outline: none;
            border-color: #6839E8;
            box-shadow: 0 0 0 4px rgba(104, 57, 232, 0.1);
        }

        .player-info-card {
            background: linear-gradient(135deg, #6839E8 0%, #8B5CF6 100%);
            border-radius: var(--radius-xl);
            padding: 30px;
            text-align: center;
            margin-bottom: 24px;
            box-shadow: 0 12px 40px rgba(104, 57, 232, 0.3);
        }

        .player-avatar {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin: 0 auto 16px;
        }

        .player-name-display {
            font-size: 1.8rem;
            font-weight: 800;
            color: white;
        }

        .ability-stats-section,
        .ability-rank-section,
        .ability-trend-section,
        .ability-tags-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
        }

        .stats-section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #0133A4;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(104, 57, 232, 0.1);
        }

        .ability-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
        }

        .ability-stat-card {
            background: #FAFAFF;
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
            border-left: 4px solid #6839E8;
        }

        .ability-stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: #6839E8;
            margin-bottom: 4px;
        }

        .ability-stat-label {
            font-size: 0.85rem;
            color: #0133A4;
            opacity: 0.7;
        }

        .rank-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        @media (max-width: 600px) {
            .rank-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .rank-card {
            background: #FAFAFF;
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
        }

        .rank-card .rank-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #6839E8;
        }

        .rank-card .rank-label {
            font-size: 0.8rem;
            color: #0133A4;
            opacity: 0.7;
            margin-top: 4px;
        }

        .rank-card.top-1 .rank-value { color: #FFD700; }
        .rank-card.top-3 .rank-value { color: #C0C0C0; }
        .rank-card.top-5 .rank-value { color: #CD7F32; }

        .recent-matches {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .recent-match-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #FAFAFF;
            border-radius: var(--radius-sm);
            border-left: 4px solid #6839E8;
        }

        .recent-match-item.win {
            border-left-color: #27F05C;
        }

        .recent-match-item.lose {
            border-left-color: #FF4D4D;
        }

        .recent-match-date {
            font-size: 0.85rem;
            color: #0133A4;
            opacity: 0.7;
        }

        .recent-match-result {
            font-weight: 700;
        }

        .recent-match-result.win { color: #27F05C; }
        .recent-match-result.lose { color: #FF4D4D; }

        .ability-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .ability-tag {
            padding: 8px 16px;
            background: linear-gradient(135deg, #F0EBFF 0%, #E8E0FF 100%);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #6839E8;
        }

        .no-data-hint {
            text-align: center;
            padding: 60px 20px;
            color: #6839E8;
            opacity: 0.6;
        }

        .no-data-hint .hint-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }

        .no-data-hint .hint-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .no-data-hint .hint-sub {
            font-size: 0.9rem;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: #0133A4;
            font-size: 0.95rem;
        }

        input, select {
            width: 100%;
            padding: 14px 18px;
            border-radius: var(--radius-md);
            border: 3px solid rgba(104, 57, 232, 0.15);
            background: #FFFFFF;
            font-size: 1rem;
            font-family: inherit;
            transition: all var(--transition-normal);
            color: #0133A4;
            font-weight: 500;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #6839E8;
            box-shadow: 0 0 0 4px rgba(104, 57, 232, 0.1);
        }

        input:focus, select:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .participants-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 15px;
        }

        .participant-checkbox {
            display: none;
        }

        .participant-label {
            display: inline-block;
            padding: 12px 24px;
            background: rgba(104, 57, 232, 0.08);
            border-radius: 50px;
            cursor: pointer;
            transition: all var(--transition-normal);
            font-weight: 600;
            border: 2px solid rgba(104, 57, 232, 0.15);
            color: #0133A4;
        }

        .participant-label:hover {
            background: rgba(104, 57, 232, 0.15);
            transform: translateY(-2px);
        }

        .participant-checkbox:checked + .participant-label {
            background: #27F05C;
            color: #000000;
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(39, 240, 92, 0.4);
        }

        .expense-result {
            margin-top: 30px;
            background: #FFFFFF;
            border-radius: var(--radius-xl);
            box-shadow: 0 16px 50px rgba(104, 57, 232, 0.2);
            padding: 35px;
            animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .expense-summary {
            font-size: 1.15rem;
            font-weight: 700;
            margin-bottom: 18px;
            color: #0133A4;
            padding: 18px;
            background: rgba(104, 57, 232, 0.08);
            border-radius: var(--radius-md);
        }

        .expense-details {
            margin-top: 20px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            margin: 10px 0;
            background: rgba(104, 57, 232, 0.05);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }

        .detail-item:hover {
            background: rgba(104, 57, 232, 0.1);
            transform: translateX(5px);
        }

        .nav-tabs {
            display: flex;
            list-style: none;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            padding: 6px;
            box-shadow: 0 8px 30px rgba(104, 57, 232, 0.12);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            gap: 4px;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            flex-shrink: 0;
            padding: 12px 16px;
            text-align: center;
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--transition-normal);
            font-weight: 600;
            font-size: 0.85rem;
            color: #0133A4;
            position: relative;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .nav-tab.active {
            background: #27F05C;
            color: #000000;
            box-shadow: 0 4px 15px rgba(39, 240, 92, 0.4);
        }

        @media (max-width: 768px) {
            .nav-tabs {
                padding: 5px;
                margin-bottom: 20px;
            }
            
            .nav-tab {
                padding: 10px 12px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .nav-tab {
                padding: 8px 10px;
                font-size: 0.75rem;
            }
        }

        .weather-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius-lg);
            padding: 18px 22px;
            box-shadow: 0 12px 40px rgba(104, 57, 232, 0.15);
            z-index: 100;
            min-width: 180px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-normal);
        }

        .weather-container.loaded {
            opacity: 1;
            transform: translateY(0);
        }

        .weather-info {
            text-align: center;
        }

        .weather-info .location {
            font-size: 0.85rem;
            color: #0133A4;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .weather-info .temperature {
            font-size: 1.8rem;
            font-weight: 900;
            color: #6839E8;
        }

        .weather-info .condition {
            font-size: 0.9rem;
            color: #0133A4;
            margin: 5px 0;
            font-weight: 500;
        }

        .weather-info .details {
            font-size: 0.75rem;
            color: rgba(1, 51, 164, 0.7);
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 8px;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .history-card {
            background: #FFFFFF;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: 0 8px 30px rgba(104, 57, 232, 0.12);
            transition: all var(--transition-normal);
        }

        .history-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 45px rgba(104, 57, 232, 0.2);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .history-date {
            font-size: 0.85rem;
            color: #0133A4;
            opacity: 0.8;
            font-weight: 500;
        }

        .history-result {
            font-size: 1.2rem;
            font-weight: 900;
            color: #6839E8;
        }

        .history-players {
            font-size: 0.95rem;
            color: var(--secondary-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--secondary-color);
            margin-top: 5px;
        }

        .settings-section {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-xl);
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
        }

        .settings-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(102, 126, 234, 0.2);
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--secondary-color);
            opacity: 0.7;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 2rem;
            }

            .score-display {
                flex-direction: column;
                gap: 30px;
            }

            .team-container {
                gap: 40px;
            }

            .score {
                font-size: 4rem;
                width: 130px;
                height: 130px;
            }

            .control-panel {
                gap: 10px;
            }

            .btn {
                padding: 12px 20px;
                font-size: 0.9rem;
            }

            .weather-container {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 20px;
            }

            .nav-tab {
                padding: 12px 15px;
            }

            .match-info {
                flex-direction: column;
                gap: 10px;
            }

            .game-mode-selector {
                flex-direction: column;
            }

            .game-mode-btn {
                width: 100%;
            }
        }

        /* ==================== 庆祝动画系统 ==================== */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confettiFall linear forwards;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .firework-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
            overflow: hidden;
        }

        .firework-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: fireworkExplode ease-out forwards;
        }

        @keyframes fireworkExplode {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        .victory-banner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            z-index: 10000;
            text-align: center;
            animation: bannerPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
            pointer-events: none;
        }

        @keyframes bannerPop {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .victory-banner h2 {
            font-size: 4rem;
            font-weight: 900;
            color: #27F05C;
            text-shadow: 0 0 20px rgba(39, 240, 92, 0.8), 0 0 40px rgba(39, 240, 92, 0.4);
            margin-bottom: 20px;
            animation: textGlow 1s ease-in-out infinite alternate;
        }

        @keyframes textGlow {
            from {
                text-shadow: 0 0 20px rgba(39, 240, 92, 0.8), 0 0 40px rgba(39, 240, 92, 0.4);
            }
            to {
                text-shadow: 0 0 30px rgba(39, 240, 92, 1), 0 0 60px rgba(39, 240, 92, 0.6), 0 0 80px rgba(39, 240, 92, 0.4);
            }
        }

        .victory-banner .trophy {
            font-size: 6rem;
            animation: trophyBounce 0.6s ease-in-out infinite alternate;
        }

        @keyframes trophyBounce {
            from {
                transform: translateY(0) rotate(-5deg);
            }
            to {
                transform: translateY(-20px) rotate(5deg);
            }
        }

        /* ==================== 分享卡片样式 ==================== */
        .share-card-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .share-card-modal.show {
            display: flex;
        }

        .share-card-wrapper {
            background: white;
            border-radius: 24px;
            padding: 24px;
            max-width: 380px;
            width: 100%;
            animation: scaleIn 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .share-card-preview {
            width: 100%;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 16px;
            position: relative;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .share-card-template-1 {
            width: 100%;
            padding: 28px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .share-card-template-1::before {
            content: '';
            position: absolute;
            top: -100px;
            right: -100px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            border-radius: 50%;
        }

        .share-card-template-1::after {
            content: '';
            position: absolute;
            bottom: -80px;
            left: -80px;
            width: 160px;
            height: 160px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .share-card-header {
            text-align: center;
            z-index: 1;
            margin-bottom: 20px;
        }

        .share-card-logo {
            font-size: 1.1rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 4px;
            letter-spacing: 1px;
        }

        .share-card-subtitle {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.75rem;
        }

        .share-card-score {
            text-align: center;
            z-index: 1;
            width: 100%;
        }

        .share-card-team-names {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .share-card-team-name {
            font-size: 1rem;
            font-weight: 700;
            color: white;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .share-card-vs {
            font-size: 0.9rem;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.5);
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        .share-card-score-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 16px 32px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        .share-card-score-number {
            font-size: 3.5rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            line-height: 1;
        }

        .share-card-score-number.winner {
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .share-card-score-separator {
            font-size: 1.5rem;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.4);
        }

        .share-card-footer {
            text-align: center;
            z-index: 1;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
        }

        .share-card-date {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            margin-bottom: 4px;
        }

        .share-card-duration {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.75rem;
        }

        .share-card-highlights {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .share-card-highlight-tag {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .share-card-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .share-card-controls .btn-dark {
            background: #6839E8;
            color: #FFFFFF;
            border: 2px solid #6839E8;
        }

        .share-card-controls .btn-dark:hover {
            background: #5a2fd1;
            border-color: #5a2fd1;
        }

        .share-card-controls .btn-success {
            background: #27F05C;
            color: #FFFFFF;
            border: 2px solid #27F05C;
        }

        .share-card-controls .btn-success:hover {
            background: #1ed14d;
            border-color: #1ed14d;
        }

        .template-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            justify-content: center;
        }

        .template-btn {
            padding: 8px 16px;
            border: 2px solid #6839E8;
            background: white;
            color: #6839E8;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .template-btn:hover,
        .template-btn.active {
            background: #6839E8;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(104, 57, 232, 0.3);
        }

        /* ==================== 成就系统样式 ==================== */
        .achievement-badge {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #fff;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.4);
            z-index: 10002;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: achievementSlideDown 0.5s ease-out forwards;
        }

        @keyframes achievementSlideDown {
            0% { transform: translateX(-50%) translateY(-100px); opacity: 0; }
            100% { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        .achievement-icon {
            font-size: 2.5rem;
            animation: achievementPulse 0.5s ease-in-out infinite alternate;
        }

        @keyframes achievementPulse {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }

        .achievement-text {
            text-align: left;
        }

        .achievement-title {
            font-size: 1.2rem;
            font-weight: 900;
            margin-bottom: 3px;
        }

        .achievement-desc {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .achievement-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
            border: 2px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(104, 57, 232, 0.2);
        }

        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(100%);
        }

        .achievement-card.locked:hover {
            transform: none;
            filter: grayscale(70%);
        }

        .achievement-card-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .achievement-card-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .achievement-card-desc {
            font-size: 0.85rem;
            color: var(--secondary-color);
            opacity: 0.8;
        }

        .achievements-summary {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .achievement-stat {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 15px 25px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }

        .achievement-stat-value {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .achievement-stat-label {
            font-size: 0.9rem;
            color: var(--secondary-color);
            margin-top: 5px;
        }

        /* ==================== 统计图表样式 ==================== */
        .charts-container {
            margin-bottom: 30px;
        }

        .chart-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 20px;
            border: 1px solid var(--glass-border);
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-canvas-container {
            position: relative;
            height: 250px;
        }

        /* ==================== 高光时刻样式 ==================== */
        .highlight-badge {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: linear-gradient(135deg, #6839E8 0%, #0133A4 100%);
            color: #fff;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(104, 57, 232, 0.5);
            z-index: 10003;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        @keyframes highlightSlideDown {
            0% { transform: translateX(-50%) translateY(-100px); opacity: 0; }
            100% { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        @keyframes highlightSlideUp {
            0% { transform: translateX(-50%) translateY(0); opacity: 1; }
            100% { transform: translateX(-50%) translateY(-100px); opacity: 0; }
        }

        .highlight-icon {
            font-size: 2.5rem;
            animation: highlightPulse 0.5s ease-in-out infinite alternate;
        }

        @keyframes highlightPulse {
            from { transform: scale(1); }
            to { transform: scale(1.2); }
        }

        .highlight-text {
            text-align: left;
        }

        .highlight-title {
            font-size: 1.2rem;
            font-weight: 900;
            margin-bottom: 3px;
        }

        .highlight-desc {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .history-highlight-tags {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .history-highlight-tag {
            background: linear-gradient(135deg, #6839E8, #0133A4);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* ==================== 排行榜样式 ==================== */
        .leaderboard-container {
            padding: 20px;
        }

        .leaderboard-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .leaderboard-tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 700;
            color: var(--secondary-color);
            transition: all var(--transition-normal);
        }

        .leaderboard-tab:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .leaderboard-tab.active {
            background: var(--accent-color);
            color: #000000;
            box-shadow: 0 4px 15px rgba(39, 240, 92, 0.4);
            transform: translateY(-2px);
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .leaderboard-item {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid var(--glass-border);
            transition: all var(--transition-normal);
        }

        .leaderboard-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 30px rgba(104, 57, 232, 0.15);
        }

        .leaderboard-rank {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 900;
            flex-shrink: 0;
        }

        .leaderboard-rank.rank-1 {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
        }

        .leaderboard-rank.rank-2 {
            background: linear-gradient(135deg, #C0C0C0, #A8A8A8);
            color: white;
            box-shadow: 0 4px 20px rgba(192, 192, 192, 0.4);
        }

        .leaderboard-rank.rank-3 {
            background: linear-gradient(135deg, #CD7F32, #8B4513);
            color: white;
            box-shadow: 0 4px 20px rgba(205, 127, 50, 0.4);
        }

        .leaderboard-rank.rank-other {
            background: rgba(104, 57, 232, 0.1);
            color: var(--primary-color);
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .leaderboard-stats {
            font-size: 0.9rem;
            color: var(--secondary-color);
            opacity: 0.8;
        }

        .leaderboard-value {
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* ==================== 头像系统样式 ==================== */
        .avatar-item {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: rgba(104, 57, 232, 0.1);
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .avatar-item:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
        }

        .avatar-item.selected {
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(39, 240, 92, 0.5);
        }

        .avatar-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: rgba(104, 57, 232, 0.1);
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .avatar-option:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
        }

        .avatar-option.selected {
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(39, 240, 92, 0.5);
        }

        .player-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: rgba(104, 57, 232, 0.15);
            border: 2px solid var(--glass-border);
        }

        @media (orientation: landscape) and (max-height: 500px) {
            .scoreboard {
                padding: 20px;
                margin-bottom: 15px;
            }

            .score-display {
                margin-bottom: 15px;
            }

            .score {
                font-size: 3rem;
                width: 100px;
                height: 100px;
            }

            .team-name {
                font-size: 1rem;
            }

            h1 {
                font-size: 1.5rem;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>羽毛球极速记分板<span class="version-badge">专业版</span></h1>
        </header>

        <ul class="nav-tabs">
            <li class="nav-tab active" data-screen="scoreboard">记分板</li>
            <li class="nav-tab" data-screen="grouping">智能分组</li>
            <li class="nav-tab" data-screen="expense">费用计算</li>
            <li class="nav-tab" data-screen="history">历史记录</li>
            <li class="nav-tab" data-screen="leaderboard">排行榜</li>
            <li class="nav-tab" data-screen="player-ability">能力分析</li>
            <li class="nav-tab" data-screen="achievements">成就系统</li>
            <li class="nav-tab" data-screen="settings">设置</li>
        </ul>

        <!-- Scoreboard Screen -->
        <div id="scoreboard" class="screen active">
            <div class="scoreboard-wrapper">
                <div class="scoreboard-header">
                    <div class="header-left">
                        <div class="timer-display">
                            <span class="timer-icon">⏱️</span>
                            <span class="timer-value" id="match-timer">00:00</span>
                        </div>
                    </div>
                    <div class="header-center">
                        <div class="game-indicator">
                            <span id="current-game">第 1 局</span>
                        </div>
                    </div>
                    <div class="header-right">
                        <div class="games-score-display">
                            <span class="score-badge" id="games-score-a">0</span>
                            <span class="score-separator">:</span>
                            <span class="score-badge" id="games-score-b">0</span>
                        </div>
                    </div>
                </div>

                <div class="scoreboard-main">
                    <div class="team-section team-a">
                        <div class="team-header">
                            <div class="team-avatar" id="team-a-avatar" onclick="selectAvatar('a')">🏸</div>
                            <div class="team-name-wrapper">
                                <input type="text" class="team-name-input" id="team-a-name" value="己方" onclick="this.select()">
                            </div>
                            <div class="games-won-dots" id="team-a-games"></div>
                        </div>
                        <div class="score-circle" id="score-a-circle" onclick="updateScore('a', 1)">
                            <span class="score-number" id="team-a-score">0</span>
                            <span class="score-label">分</span>
                        </div>
                        <div class="score-buttons">
                            <button class="score-btn minus" onclick="updateScore('a', -1)">−</button>
                            <button class="score-btn plus" onclick="updateScore('a', 1)">+</button>
                        </div>
                    </div>

                    <div class="vs-section">
                        <div class="vs-text">VS</div>
                        <div class="vs-line"></div>
                    </div>

                    <div class="team-section team-b">
                        <div class="team-header">
                            <div class="team-avatar" id="team-b-avatar" onclick="selectAvatar('b')">🏸</div>
                            <div class="team-name-wrapper">
                                <input type="text" class="team-name-input" id="team-b-name" value="对方" onclick="this.select()">
                            </div>
                            <div class="games-won-dots" id="team-b-games"></div>
                        </div>
                        <div class="score-circle" id="score-b-circle" onclick="updateScore('b', 1)">
                            <span class="score-number" id="team-b-score">0</span>
                            <span class="score-label">分</span>
                        </div>
                        <div class="score-buttons">
                            <button class="score-btn minus" onclick="updateScore('b', -1)">−</button>
                            <button class="score-btn plus" onclick="updateScore('b', 1)">+</button>
                        </div>
                    </div>
                </div>

                <div class="game-mode-section">
                    <div class="mode-label">赛制选择</div>
                    <div class="game-mode-chips">
                        <div class="mode-chip active" data-mode="21" onclick="setGameMode(21)">21分</div>
                        <div class="mode-chip" data-mode="15" onclick="setGameMode(15)">15分</div>
                        <div class="mode-chip" data-mode="11" onclick="setGameMode(11)">11分</div>
                        <div class="mode-chip" data-mode="custom" onclick="setGameMode('custom')">自定义</div>
                    </div>
                </div>

                <div class="control-buttons">
                    <button class="control-btn secondary" onclick="undoScore()">
                        <span class="btn-icon">↩️</span>
                        <span class="btn-text">撤销</span>
                    </button>
                    <button class="control-btn primary" id="timer-button" onclick="toggleTimer()">
                        <span class="btn-icon">▶️</span>
                        <span class="btn-text">开始比赛</span>
                    </button>
                    <button class="control-btn warning" onclick="endGame()">
                        <span class="btn-icon">🏁</span>
                        <span class="btn-text">结束本局</span>
                    </button>
                    <button class="control-btn secondary" onclick="resetMatch()">
                        <span class="btn-icon">🔄</span>
                        <span class="btn-text">重置</span>
                    </button>
                </div>
            </div>

            <!-- Result Form -->
            <div id="result-form" class="result-card" style="display: none;">
                <h2 class="result-title">比赛结果</h2>
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label for="team-a-names">己方选手</label>
                        <input type="text" id="team-a-names" placeholder="例如：老王/老张">
                    </div>
                    <div style="display: flex; align-items: flex-end; padding-bottom: 24px;">vs</div>
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label for="team-b-names">对方选手</label>
                        <input type="text" id="team-b-names" placeholder="例如：小李/小陈">
                    </div>
                </div>
                <div class="control-panel">
                    <button class="btn btn-primary" onclick="saveMatchResult()">保存比赛</button>
                    <button class="btn btn-success" onclick="openShareCardModal()">生成分享卡片 ✨</button>
                    <button class="btn btn-dark" onclick="shareResult()">分享结果</button>
                </div>
            </div>
        </div>

        <!-- Grouping Screen -->
        <div id="grouping" class="screen">
            <div class="grouping-container">
                <div class="grouping-header">
                    <h2 class="section-title">🏸 智能分组系统</h2>
                    <p class="section-subtitle">快速生成公平合理的比赛分组</p>
                </div>

                <div class="grouping-main">
                    <div class="grouping-left">
                        <div class="input-section">
                            <label class="input-label">
                                <span class="label-icon">👥</span>
                                参与人员
                            </label>
                            <textarea id="players-list" class="players-textarea" placeholder="每行输入一个名字，例如：&#10;张三&#10;李四&#10;王五&#10;赵六&#10;钱七&#10;孙八" rows="8"></textarea>
                            <div class="player-count-hint">
                                已输入 <span id="player-count">0</span> 人
                            </div>
                        </div>

                        <div class="quick-add-section">
                            <label class="input-label">快速添加</label>
                            <div class="quick-add-buttons">
                                <button class="quick-add-btn" onclick="quickAddPlayer('张三')">+ 张三</button>
                                <button class="quick-add-btn" onclick="quickAddPlayer('李四')">+ 李四</button>
                                <button class="quick-add-btn" onclick="quickAddPlayer('王五')">+ 王五</button>
                                <button class="quick-add-btn" onclick="quickAddPlayer('赵六')">+ 赵六</button>
                            </div>
                        </div>
                    </div>

                    <div class="grouping-right">
                        <div class="mode-section">
                            <label class="input-label">
                                <span class="label-icon">⚙️</span>
                                分组模式
                            </label>
                            <div class="mode-cards">
                                <div class="mode-card active" data-mode="random" onclick="selectGroupMode('random')">
                                    <div class="mode-icon">🎲</div>
                                    <div class="mode-name">随机分组</div>
                                    <div class="mode-desc">完全随机配对</div>
                                </div>
                                <div class="mode-card" data-mode="balanced" onclick="selectGroupMode('balanced')">
                                    <div class="mode-icon">⚖️</div>
                                    <div class="mode-name">实力平衡</div>
                                    <div class="mode-desc">强弱搭配更公平</div>
                                </div>
                                <div class="mode-card" data-mode="rotation" onclick="selectGroupMode('rotation')">
                                    <div class="mode-icon">🔄</div>
                                    <div class="mode-name">轮换赛制</div>
                                    <div class="mode-desc">人人都能搭档</div>
                                </div>
                            </div>
                            <input type="hidden" id="group-mode" value="random">
                        </div>

                        <div class="skill-section" id="skill-input-container" style="display: none;">
                            <label class="input-label">
                                <span class="label-icon">💪</span>
                                实力等级
                            </label>
                            <div class="skill-hint">为每位选手设置实力等级（1-5分）</div>
                            <div id="skill-inputs" class="skill-inputs-grid"></div>
                        </div>

                        <div class="grouping-actions">
                            <button class="btn btn-primary btn-large" onclick="generateGroups()">
                                <span class="btn-icon">✨</span>
                                智能分组
                            </button>
                            <button class="btn btn-outline" onclick="clearGroups()">
                                <span class="btn-icon">🗑️</span>
                                清空
                            </button>
                        </div>
                    </div>
                </div>

                <div class="group-results-section" id="group-results-section" style="display: none;">
                    <div class="results-header">
                        <h3 class="results-title">📋 分组结果</h3>
                        <div class="results-actions">
                            <button class="btn btn-small btn-outline" onclick="regenerateGroups()">🔄 重新分组</button>
                            <button class="btn btn-small btn-success" onclick="exportGroups()">📤 导出</button>
                        </div>
                    </div>
                    <div class="group-results" id="group-results"></div>
                    <div class="group-stats" id="group-stats"></div>
                </div>

                <div class="grouping-history-section" id="grouping-history-section">
                    <div class="history-header">
                        <h3 class="history-title">📜 分组历史</h3>
                        <button class="btn btn-small btn-outline" onclick="clearGroupingHistory()">清空历史</button>
                    </div>
                    <div class="grouping-history-list" id="grouping-history-list"></div>
                </div>
            </div>
        </div>

        <!-- Expense Tracker Screen -->
        <div id="expense" class="screen">
            <div class="expense-container">
                <div class="expense-header">
                    <h2 class="section-title">💰 费用分摊计算器</h2>
                    <p class="section-subtitle">轻松计算AA费用，公平合理分摊</p>
                </div>

                <div class="expense-main">
                    <div class="expense-left">
                        <div class="expense-type-section">
                            <label class="input-label">
                                <span class="label-icon">📋</span>
                                费用类型
                            </label>
                            <div class="expense-type-cards">
                                <div class="expense-type-card active" data-type="场地费" onclick="selectExpenseType('场地费')">
                                    <div class="type-icon">🏟️</div>
                                    <div class="type-name">场地费</div>
                                </div>
                                <div class="expense-type-card" data-type="球费" onclick="selectExpenseType('球费')">
                                    <div class="type-icon">🏸</div>
                                    <div class="type-name">球费</div>
                                </div>
                                <div class="expense-type-card" data-type="饮用水" onclick="selectExpenseType('饮用水')">
                                    <div class="type-icon">💧</div>
                                    <div class="type-name">饮用水</div>
                                </div>
                                <div class="expense-type-card" data-type="其他" onclick="selectExpenseType('其他')">
                                    <div class="type-icon">📦</div>
                                    <div class="type-name">其他</div>
                                </div>
                            </div>
                            <input type="hidden" id="expense-type" value="场地费">
                        </div>

                        <div class="amount-section">
                            <label class="input-label">
                                <span class="label-icon">💵</span>
                                总金额
                            </label>
                            <div class="amount-input-wrapper">
                                <span class="currency-symbol">¥</span>
                                <input type="number" id="total-amount" class="amount-input" min="0" step="0.01" placeholder="0.00">
                            </div>
                            <div class="quick-amounts">
                                <button class="quick-amount-btn" onclick="setQuickAmount(50)">50元</button>
                                <button class="quick-amount-btn" onclick="setQuickAmount(100)">100元</button>
                                <button class="quick-amount-btn" onclick="setQuickAmount(150)">150元</button>
                                <button class="quick-amount-btn" onclick="setQuickAmount(200)">200元</button>
                            </div>
                        </div>
                    </div>

                    <div class="expense-right">
                        <div class="split-mode-section">
                            <label class="input-label">
                                <span class="label-icon">⚖️</span>
                                分摊模式
                            </label>
                            <div class="split-mode-cards">
                                <div class="split-mode-card active" data-mode="equal" onclick="selectSplitMode('equal')">
                                    <div class="mode-icon">➗</div>
                                    <div class="mode-name">平均分摊</div>
                                    <div class="mode-desc">每人平分</div>
                                </div>
                                <div class="split-mode-card" data-mode="custom" onclick="selectSplitMode('custom')">
                                    <div class="mode-icon">📊</div>
                                    <div class="mode-name">自定义比例</div>
                                    <div class="mode-desc">按比例分配</div>
                                </div>
                                <div class="split-mode-card" data-mode="time" onclick="selectSplitMode('time')">
                                    <div class="mode-icon">⏱️</div>
                                    <div class="mode-name">按时长</div>
                                    <div class="mode-desc">按比赛时长</div>
                                </div>
                            </div>
                            <input type="hidden" id="split-mode" value="equal">
                        </div>

                        <div class="participants-section">
                            <label class="input-label">
                                <span class="label-icon">👥</span>
                                参与人员
                            </label>
                            <div class="participants-input-wrapper">
                                <textarea id="expense-players" class="participants-textarea" placeholder="每行输入一个名字" rows="4"></textarea>
                                <div class="participant-count-hint">
                                    已添加 <span id="participant-count">0</span> 人
                                </div>
                            </div>
                            <div id="custom-ratio-container" class="custom-ratio-container" style="display: none;">
                                <label class="input-label">分摊比例</label>
                                <div id="ratio-inputs" class="ratio-inputs-grid"></div>
                            </div>
                        </div>

                        <div class="expense-actions">
                            <button class="btn btn-primary btn-large" onclick="calculateExpense()">
                                <span class="btn-icon">🧮</span>
                                计算分摊
                            </button>
                            <button class="btn btn-outline" onclick="clearExpenseForm()">
                                <span class="btn-icon">🗑️</span>
                                清空
                            </button>
                        </div>
                    </div>
                </div>

                <div class="expense-result-section" id="expense-result-section" style="display: none;">
                    <div class="result-header">
                        <h3 class="result-title">📊 分摊结果</h3>
                        <div class="result-actions">
                            <button class="btn btn-small btn-outline" onclick="copyExpenseResult()">📋 复制</button>
                            <button class="btn btn-small btn-success" onclick="exportExpense()">📤 导出</button>
                        </div>
                    </div>
                    <div class="expense-summary-card" id="expense-summary"></div>
                    <div class="expense-details-list" id="expense-details"></div>
                </div>

                <div class="expense-history-section" id="expense-history-section">
                    <div class="history-header">
                        <h3 class="history-title">📜 分摊历史</h3>
                        <button class="btn btn-small btn-outline" onclick="clearExpenseHistory()">清空历史</button>
                    </div>
                    <div class="expense-history-list" id="expense-history-list"></div>
                </div>
            </div>
        </div>

        <!-- Expense Detail Modal -->
        <div class="expense-detail-modal" id="expense-detail-modal">
            <div class="expense-detail-wrapper">
                <div class="detail-modal-header">
                    <h3 class="detail-modal-title">📋 分摊详情</h3>
                    <button class="detail-close-btn" onclick="closeExpenseDetailModal()">✕</button>
                </div>
                <div class="expense-summary-card" id="expense-detail-summary"></div>
                <div class="expense-details-list" id="expense-detail-list"></div>
            </div>
        </div>

        <!-- History Screen -->
        <div id="history" class="screen">
            <div class="history-wrapper">
                <div class="history-header">
                    <h2 class="section-title">📊 比赛记录</h2>
                    <p class="section-subtitle">查看历史比赛数据与统计</p>
                </div>

                <!-- 统计概览 -->
                <div class="stats-overview">
                    <div class="stats-summary-card">
                        <div class="stats-summary-main">
                            <div class="stats-big-number" id="total-matches">0</div>
                            <div class="stats-big-label">场比赛</div>
                        </div>
                        <div class="stats-summary-details">
                            <div class="stats-detail-item">
                                <span class="detail-value" id="total-wins">0</span>
                                <span class="detail-label">胜</span>
                            </div>
                            <div class="stats-detail-item">
                                <span class="detail-value" id="total-losses">0</span>
                                <span class="detail-label">负</span>
                            </div>
                            <div class="stats-detail-item">
                                <span class="detail-value" id="win-rate">0%</span>
                                <span class="detail-label">胜率</span>
                            </div>
                            <div class="stats-detail-item">
                                <span class="detail-value" id="total-time">0h</span>
                                <span class="detail-label">时长</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 图表区域 -->
                <div class="charts-section">
                    <div class="chart-card">
                        <div class="chart-title">📈 月度比赛趋势</div>
                        <div class="chart-canvas-container">
                            <canvas id="monthlyChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">🥧 胜负分布</div>
                        <div class="chart-canvas-container">
                            <canvas id="winLossChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="history-actions-bar">
                    <button class="btn btn-outline" onclick="exportHistory()">
                        <span>📤</span> 导出记录
                    </button>
                    <button class="btn btn-outline" onclick="clearHistory()">
                        <span>🗑️</span> 清空历史
                    </button>
                </div>

                <!-- 历史记录列表 -->
                <div class="history-list-section">
                    <div class="list-header">
                        <h3 class="list-title">比赛历史</h3>
                        <span class="list-count" id="history-count">0 场</span>
                    </div>
                    <div class="history-list" id="history-list">
                        <div class="empty-state">
                            <div class="empty-state-icon">🏸</div>
                            <p>暂无比赛记录</p>
                            <p class="empty-state-hint">开始一场比赛后会自动记录在这里</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leaderboard Screen -->
        <div id="leaderboard" class="screen">
            <div class="leaderboard-wrapper">
                <div class="leaderboard-header">
                    <h2 class="section-title">🏆 选手排行榜</h2>
                    <p class="section-subtitle">基于真实比赛数据的排名</p>
                </div>

                <div class="leaderboard-tabs">
                    <div class="tab-item active" data-type="wins" onclick="switchLeaderboard('wins')">
                        <span class="tab-icon">🥇</span>
                        <span class="tab-text">胜场</span>
                    </div>
                    <div class="tab-item" data-type="matches" onclick="switchLeaderboard('matches')">
                        <span class="tab-icon">🎯</span>
                        <span class="tab-text">参赛</span>
                    </div>
                    <div class="tab-item" data-type="winrate" onclick="switchLeaderboard('winrate')">
                        <span class="tab-icon">📈</span>
                        <span class="tab-text">胜率</span>
                    </div>
                    <div class="tab-item" data-type="duration" onclick="switchLeaderboard('duration')">
                        <span class="tab-icon">⏱️</span>
                        <span class="tab-text">时长</span>
                    </div>
                </div>

                <div class="leaderboard-content">
                    <div class="top-three-section" id="top-three-section"></div>
                    <div class="leaderboard-list-section">
                        <div class="list-header">
                            <span>排名</span>
                            <span>选手</span>
                            <span>数据</span>
                        </div>
                        <div class="leaderboard-list" id="leaderboard-list">
                            <div class="empty-state">
                                <div class="empty-state-icon">🏸</div>
                                <p>暂无数据</p>
                                <p class="empty-state-hint">开始比赛后会自动生成排行榜</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Player Ability Screen -->
        <div id="player-ability" class="screen">
            <div class="ability-container">
                <div class="ability-header">
                    <h2 class="section-title">📊 选手数据分析</h2>
                    <p class="section-subtitle">基于真实比赛记录的统计数据</p>
                </div>

                <div class="ability-main">
                    <div class="player-selector-section">
                        <label class="input-label">
                            <span class="label-icon">👤</span>
                            选择选手
                        </label>
                        <select id="ability-player-select" class="player-select" onchange="renderPlayerAbility()">
                            <option value="">请选择选手...</option>
                        </select>
                    </div>

                    <div id="ability-display" style="display: none;">
                        <div class="player-info-card">
                            <div class="player-avatar" id="player-avatar">🏸</div>
                            <div class="player-name-display" id="player-name-display"></div>
                        </div>

                        <div class="ability-stats-section">
                            <h3 class="stats-section-title">📈 基础统计</h3>
                            <div class="ability-stats-grid" id="ability-stats-grid"></div>
                        </div>

                        <div class="ability-rank-section">
                            <h3 class="stats-section-title">🏅 排名情况</h3>
                            <div class="rank-cards" id="rank-cards"></div>
                        </div>

                        <div class="ability-trend-section">
                            <h3 class="stats-section-title">📉 近期表现</h3>
                            <div class="recent-matches" id="recent-matches"></div>
                        </div>

                        <div class="ability-tags-section">
                            <h3 class="stats-section-title">🏷️ 成就标签</h3>
                            <div class="ability-tags" id="ability-tags"></div>
                        </div>
                    </div>

                    <div id="no-data-hint" class="no-data-hint">
                        <div class="hint-icon">🏸</div>
                        <div class="hint-text">选择选手查看详细数据分析</div>
                        <div class="hint-sub">数据来源于真实比赛记录</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Achievements Screen -->
        <div id="achievements" class="screen">
            <div class="achievements-wrapper">
                <div class="achievements-header">
                    <h2 class="section-title">🏆 成就系统</h2>
                    <p class="section-subtitle">记录你的每一个里程碑</p>
                </div>

                <div class="achievements-progress-card">
                    <div class="progress-ring">
                        <svg viewBox="0 0 100 100">
                            <circle class="progress-bg" cx="50" cy="50" r="45"></circle>
                            <circle class="progress-bar" cx="50" cy="50" r="45" id="achievement-progress-ring"></circle>
                        </svg>
                        <div class="progress-text">
                            <span class="progress-value" id="achievements-progress">0%</span>
                            <span class="progress-label">完成度</span>
                        </div>
                    </div>
                    <div class="progress-stats">
                        <div class="progress-stat">
                            <span class="stat-num" id="achievements-unlocked">0</span>
                            <span class="stat-text">已解锁</span>
                        </div>
                        <div class="progress-stat">
                            <span class="stat-num" id="achievements-total">12</span>
                            <span class="stat-text">总成就</span>
                        </div>
                    </div>
                </div>

                <div class="achievements-categories">
                    <div class="achievement-category">
                        <div class="category-header">
                            <span class="category-icon">🏸</span>
                            <span class="category-title">比赛成就</span>
                        </div>
                        <div class="category-achievements" id="match-achievements"></div>
                    </div>
                    
                    <div class="achievement-category">
                        <div class="category-header">
                            <span class="category-icon">🏆</span>
                            <span class="category-title">胜利成就</span>
                        </div>
                        <div class="category-achievements" id="win-achievements"></div>
                    </div>
                    
                    <div class="achievement-category">
                        <div class="category-header">
                            <span class="category-icon">⏱️</span>
                            <span class="category-title">时长成就</span>
                        </div>
                        <div class="category-achievements" id="duration-achievements"></div>
                    </div>
                    
                    <div class="achievement-category">
                        <div class="category-header">
                            <span class="category-icon">✨</span>
                            <span class="category-title">特殊成就</span>
                        </div>
                        <div class="category-achievements" id="special-achievements"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settings" class="screen">
            <div class="settings-wrapper">
                <div class="settings-header">
                    <h2 class="section-title">⚙️ 设置</h2>
                    <p class="section-subtitle">个性化你的使用体验</p>
                </div>

                <div class="settings-content">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="card-icon">🎨</span>
                            <span class="card-title">主题设置</span>
                        </div>
                        <div class="theme-grid">
                            <div class="theme-card active" data-theme="purple" onclick="setTheme('purple')">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #6839E8, #0133A4);"></div>
                                <div class="theme-info">
                                    <span class="theme-emoji">💜</span>
                                    <span class="theme-name">暗夜紫</span>
                                </div>
                            </div>
                            <div class="theme-card" data-theme="orange" onclick="setTheme('orange')">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #FF6B35, #D63031);"></div>
                                <div class="theme-info">
                                    <span class="theme-emoji">🧡</span>
                                    <span class="theme-name">活力橙</span>
                                </div>
                            </div>
                            <div class="theme-card" data-theme="blue" onclick="setTheme('blue')">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #0984E3, #0066CC);"></div>
                                <div class="theme-info">
                                    <span class="theme-emoji">💙</span>
                                    <span class="theme-name">天空蓝</span>
                                </div>
                            </div>
                            <div class="theme-card" data-theme="green" onclick="setTheme('green')">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #00B894, #009432);"></div>
                                <div class="theme-info">
                                    <span class="theme-emoji">💚</span>
                                    <span class="theme-name">森林绿</span>
                                </div>
                            </div>
                            <div class="theme-card" data-theme="pink" onclick="setTheme('pink')">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #E84393, #C44569);"></div>
                                <div class="theme-info">
                                    <span class="theme-emoji">💗</span>
                                    <span class="theme-name">樱花粉</span>
                                </div>
                            </div>
                            <div class="theme-card" data-theme="blackgold" onclick="setTheme('blackgold')">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #2D2D2D, #1A1A1A);"></div>
                                <div class="theme-info">
                                    <span class="theme-emoji">🖤</span>
                                    <span class="theme-name">黑金商务</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="card-icon">🏸</span>
                            <span class="card-title">比赛设置</span>
                        </div>
                        <div class="settings-options">
                            <div class="setting-row">
                                <div class="setting-info">
                                    <span class="setting-label">自定义目标分数</span>
                                    <span class="setting-desc">设置比赛的获胜分数</span>
                                </div>
                                <input type="number" id="custom-score" value="21" min="1" max="50" class="setting-input">
                            </div>
                            <div class="setting-row">
                                <div class="setting-info">
                                    <span class="setting-label">三局两胜制</span>
                                    <span class="setting-desc">先赢两局者获胜</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="best-of-three" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <div class="setting-info">
                                    <span class="setting-label">加分赛</span>
                                    <span class="setting-desc">平分后需领先2分获胜，30分封顶</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="deuce-mode" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="card-icon">🔔</span>
                            <span class="card-title">声音与反馈</span>
                        </div>
                        <div class="settings-options">
                            <div class="setting-row">
                                <div class="setting-info">
                                    <span class="setting-label">得分音效</span>
                                    <span class="setting-desc">得分时播放提示音</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="sound-enabled" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <div class="setting-info">
                                    <span class="setting-label">震动反馈</span>
                                    <span class="setting-desc">得分时震动提示</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="vibration-enabled" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <div class="setting-info">
                                    <span class="setting-label">换边提醒</span>
                                    <span class="setting-desc">达到规定分数时提醒换边</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="side-change-alert" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="card-icon">👤</span>
                            <span class="card-title">选手头像</span>
                        </div>
                        <div class="avatar-section">
                            <div class="avatar-library" id="avatar-library"></div>
                            <button class="btn btn-outline" onclick="openAvatarManager()">
                                <span>✏️</span> 管理选手头像
                            </button>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <span class="card-icon">💾</span>
                            <span class="card-title">数据管理</span>
                        </div>
                        <div class="data-actions">
                            <button class="data-btn backup" onclick="backupData()">
                                <span class="btn-icon">📤</span>
                                <div class="btn-content">
                                    <span class="btn-title">备份数据</span>
                                    <span class="btn-desc">导出所有数据到文件</span>
                                </div>
                            </button>
                            <button class="data-btn restore" onclick="restoreData()">
                                <span class="btn-icon">📥</span>
                                <div class="btn-content">
                                    <span class="btn-title">恢复数据</span>
                                    <span class="btn-desc">从备份文件恢复</span>
                                </div>
                            </button>
                            <button class="data-btn danger" onclick="clearAllData()">
                                <span class="btn-icon">🗑️</span>
                                <div class="btn-content">
                                    <span class="btn-title">清除数据</span>
                                    <span class="btn-desc">删除所有本地数据</span>
                                </div>
                            </button>
                        </div>
                        <input type="file" id="restore-file" accept=".json" style="display: none;" onchange="handleRestoreFile(event)">
                    </div>

                    <div class="settings-card about-card">
                        <div class="about-content">
                            <div class="about-logo">🏸</div>
                            <div class="about-info">
                                <div class="about-name">羽毛球极速计分板</div>
                                <div class="about-version">版本 2.0</div>
                                <div class="about-author">设计 & 开发：试界</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <span class="footer-logo">🏸</span>
            <span class="footer-text">羽毛球极速计分板</span>
            <span class="footer-divider">·</span>
            <span class="footer-author">试界 TryWorld</span>
        </div>
    </footer>

    <!-- Notification -->
    <div class="notification" id="notification">
        <h3 id="notification-title">提示</h3>
        <p id="notification-message">消息内容</p>
        <button class="btn btn-primary btn-small" onclick="hideNotification()">确定</button>
    </div>

    <!-- Input Dialog -->
    <div class="input-dialog" id="input-dialog">
        <h3 id="input-dialog-title">请输入</h3>
        <input type="text" id="input-dialog-input" placeholder="请输入内容...">
        <div class="input-dialog-buttons">
            <button class="btn btn-dark btn-small" onclick="hideInputDialog(false)">取消</button>
            <button class="btn btn-primary btn-small" onclick="hideInputDialog(true)">确定</button>
        </div>
    </div>

    <!-- Weather Container -->
    <div class="weather-container" id="weather-container">
        <div class="weather-info">
            <div class="location">获取位置中...</div>
            <div class="temperature">-- °C</div>
            <div class="condition">--</div>
            <div class="details">
                <span>湿度: --%</span>
                <span>风力: -- 级</span>
            </div>
        </div>
    </div>

    <!-- Celebration Containers -->
    <div class="confetti-container" id="confetti-container"></div>
    <div class="firework-container" id="firework-container"></div>
    <div class="victory-banner" id="victory-banner" style="display: none;">
        <div class="trophy">🏆</div>
        <h2>获胜!</h2>
    </div>

    <!-- Achievement Badge -->
    <div class="achievement-badge" id="achievement-badge" style="display: none;">
        <div class="achievement-icon">🏅</div>
        <div class="achievement-text">
            <div class="achievement-title" id="achievement-title">成就解锁!</div>
            <div class="achievement-desc" id="achievement-desc">描述</div>
        </div>
    </div>

    <!-- Share Card Modal -->
    <div class="share-card-modal" id="share-card-modal">
        <div class="share-card-wrapper">
            <div class="template-selector">
                <button class="template-btn active" data-template="1" onclick="selectShareTemplate(1)">💜 紫韵</button>
                <button class="template-btn" data-template="2" onclick="selectShareTemplate(2)">💖 热情</button>
                <button class="template-btn" data-template="3" onclick="selectShareTemplate(3)">💙 清新</button>
            </div>
            <div class="share-card-preview" id="share-card-preview"></div>
            <div class="share-card-controls">
                <button class="btn btn-success" onclick="downloadShareCard()">💾 保存图片</button>
                <button class="btn btn-dark" onclick="closeShareCardModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- Avatar Manager Modal -->
    <div class="share-card-modal" id="avatar-manager-modal">
        <div class="share-card-wrapper">
            <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary-color); font-size: 1.5rem; font-weight: 900;">🎭 选手头像管理</h3>
            <div class="form-group" style="margin-bottom: 20px;">
                <label>选手名称</label>
                <input type="text" id="avatar-player-name" placeholder="输入选手名称">
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; font-weight: 700; color: var(--secondary-color);">选择头像</label>
                <div class="avatar-selector" id="avatar-selector" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 10px;"></div>
            </div>
            <div class="share-card-controls">
                <button class="btn btn-primary" onclick="savePlayerAvatar()">保存头像</button>
                <button class="btn btn-dark" onclick="closeAvatarManager()">关闭</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== 全局变量 ====================
        let timerInterval = null;
        let seconds = 0;
        let timerRunning = false;
        let scoreA = 0;
        let scoreB = 0;
        let gamesWonA = 0;
        let gamesWonB = 0;
        let currentGame = 1;
        let targetScore = 21;
        let gameMode = 21;
        let scoreHistory = [];
        let gameScoresHistory = [];
        let currentScreen = 'scoreboard';
        let teamNameA = '己方';
        let teamNameB = '对方';

        // ==================== 成就系统 ====================
        const achievementsList = [
            { id: 'first_match', icon: '🏸', title: '初次登场', desc: '完成第一场比赛', type: 'match', value: 1 },
            { id: 'ten_matches', icon: '🎯', title: '小有成就', desc: '完成10场比赛', type: 'match', value: 10 },
            { id: 'fifty_matches', icon: '🏆', title: '球场老将', desc: '完成50场比赛', type: 'match', value: 50 },
            { id: 'first_win', icon: '🎉', title: '首胜', desc: '赢得第一场比赛', type: 'win', value: 1 },
            { id: 'ten_wins', icon: '🥈', title: '常胜将军', desc: '赢得10场比赛', type: 'win', value: 10 },
            { id: 'twentyfive_wins', icon: '🥇', title: '羽坛王者', desc: '赢得25场比赛', type: 'win', value: 25 },
            { id: 'streak_3', icon: '🔥', title: '三连胜', desc: '连续赢得3场比赛', type: 'streak', value: 3 },
            { id: 'streak_5', icon: '💥', title: '五连胜', desc: '连续赢得5场比赛', type: 'streak', value: 5 },
            { id: 'play_hour', icon: '⏱️', title: '球痴', desc: '累计打球1小时', type: 'duration', value: 3600 },
            { id: 'play_5hours', icon: '⌛', title: '球瘾', desc: '累计打球5小时', type: 'duration', value: 18000 },
            { id: 'perfect_win', icon: '✨', title: '完美胜利', desc: '一局比赛零封对手', type: 'perfect', value: 1 },
            { id: 'deuce_master', icon: '🎮', title: '加分赛专家', desc: '经历3次加分赛', type: 'deuce', value: 3 }
        ];

        let unlockedAchievements = [];
        let totalMatches = 0;
        let totalWins = 0;
        let currentStreak = 0;
        let totalDuration = 0;
        let deuceCount = 0;

        // ==================== 初始化 ====================
        document.addEventListener('DOMContentLoaded', function() {
            initNavigation();
            initServiceWorker();
            loadSettings();
            loadMatchState();
            updateGamesWonDisplay();
            loadHistory();
            initWeather();
            loadAchievements();
            initAchievements();
            loadTheme();
            initAvatars();
            initPlayerAbilitySelector();
            initGrouping();
            initExpense();
        });

        /**
         * 初始化分组功能
         */
        function initGrouping() {
            const playersTextarea = document.getElementById('players-list');
            if (playersTextarea) {
                playersTextarea.addEventListener('input', function() {
                    updatePlayerCount();
                    updateSkillInputs();
                });
            }
            loadGroupingHistory();
        }

        /**
         * 初始化费用计算功能
         */
        function initExpense() {
            const expensePlayers = document.getElementById('expense-players');
            if (expensePlayers) {
                expensePlayers.addEventListener('input', function() {
                    updateParticipantCount();
                    updateRatioInputs();
                });
            }
            loadExpenseHistory();
        }

        /**
         * 设置主题
         * @param {string} theme - 主题名称
         */
        function setTheme(theme) {
            const html = document.documentElement;
            
            if (theme === 'purple') {
                html.removeAttribute('data-theme');
            } else {
                html.setAttribute('data-theme', theme);
            }
            
            document.querySelectorAll('.theme-card').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`.theme-card[data-theme="${theme}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            localStorage.setItem('theme', theme);
            
            if (currentScreen === 'history') {
                destroyCharts();
                setTimeout(() => initCharts(), 100);
            }
        }

        /**
         * 加载保存的主题
         */
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme && savedTheme !== 'purple') {
                setTheme(savedTheme);
            } else {
                const purpleBtn = document.querySelector('.theme-btn[data-theme="purple"]');
                if (purpleBtn) {
                    purpleBtn.style.borderColor = '#27F05C';
                    purpleBtn.style.transform = 'scale(1.05)';
                    purpleBtn.style.boxShadow = '0 0 20px rgba(39, 240, 92, 0.5)';
                }
            }
        }

        /**
         * 初始化导航标签
         */
        function initNavigation() {
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const screenId = this.getAttribute('data-screen');
                    if (screenId === currentScreen) return;
                    
                    navTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const currentScreenEl = document.querySelector('.screen.active');
                    const nextScreenEl = document.getElementById(screenId);
                    
                    if (currentScreenEl) {
                        currentScreenEl.classList.add('fade-out');
                        setTimeout(() => {
                            currentScreenEl.classList.remove('active', 'fade-out');
                            nextScreenEl.classList.add('active');
                            currentScreen = screenId;
                            
                            if (screenId === 'history') {
                                setTimeout(() => initCharts(), 100);
                            } else if (screenId === 'leaderboard') {
                                setTimeout(() => renderLeaderboard(), 100);
                            } else if (screenId === 'player-ability') {
                                setTimeout(() => {
                                    initPlayerAbilitySelector();
                                    renderPlayerAbility();
                                }, 100);
                            } else if (screenId === 'achievements') {
                                setTimeout(() => {
                                    renderAchievements();
                                    updateAchievementsSummary();
                                }, 100);
                            }
                        }, 200);
                    } else {
                        nextScreenEl.classList.add('active');
                        currentScreen = screenId;
                    }
                });
            });
        }

        /**
         * 初始化Service Worker
         */
        function initServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful');
                }).catch(function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            }
        }

        /**
         * 初始化分组模式监听器
         */
        // ==================== 计时器功能 ====================
        /**
         * 切换计时器状态
         */
        function toggleTimer() {
            const timerButton = document.getElementById('timer-button');
            if (timerRunning) {
                clearInterval(timerInterval);
                timerButton.innerHTML = '<span class="btn-icon">▶️</span><span class="btn-text">继续比赛</span>';
            } else {
                timerInterval = setInterval(updateTimer, 1000);
                timerButton.innerHTML = '<span class="btn-icon">⏸️</span><span class="btn-text">暂停比赛</span>';
            }
            timerRunning = !timerRunning;
            saveMatchState();
        }

        /**
         * 更新计时器显示
         */
        function updateTimer() {
            seconds++;
            const minutes = Math.floor(seconds / 60);
            const displaySeconds = seconds % 60;
            document.getElementById('match-timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${displaySeconds.toString().padStart(2, '0')}`;
        }

        /**
         * 重置计时器
         */
        function resetTimer() {
            clearInterval(timerInterval);
            seconds = 0;
            timerRunning = false;
            document.getElementById('match-timer').textContent = '00:00';
            document.getElementById('timer-button').innerHTML = '<span class="btn-icon">▶️</span><span class="btn-text">开始比赛</span>';
        }

        // ==================== 比赛模式设置 ====================
        /**
         * 设置比赛模式
         * @param {number|string} mode - 比赛模式（21、15、11或'custom'）
         */
        function setGameMode(mode) {
            document.querySelectorAll('.mode-chip').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.mode-chip[data-mode="${mode}"]`).classList.add('active');
            
            gameMode = mode;
            if (mode === 'custom') {
                const customInput = document.getElementById('custom-score');
                targetScore = customInput ? parseInt(customInput.value) || 21 : 21;
                if (!customInput) {
                    const score = prompt('请输入目标分数：', '21');
                    if (score) {
                        targetScore = parseInt(score) || 21;
                    }
                }
            } else {
                targetScore = mode;
            }
            saveSettings();
        }

        // ==================== 记分功能 ====================
        /**
         * 更新比分
         * @param {string} team - 队伍标识（'a'或'b'）
         * @param {number} amount - 分数变化量
         */
        function updateScore(team, amount) {
            if (!timerRunning) {
                showNotification('提示', '请先点击"开始比赛"按钮开始计时！');
                return;
            }
            
            const oldScore = team === 'a' ? scoreA : scoreB;
            const newScore = Math.max(0, oldScore + amount);
            
            scoreHistory.push({ team, oldScore, newScore, timestamp: Date.now() });
            
            if (team === 'a') {
                scoreA = newScore;
                document.getElementById('team-a-score').textContent = scoreA;
                document.getElementById('score-a-circle').classList.add('pulse');
                setTimeout(() => document.getElementById('score-a-circle').classList.remove('pulse'), 300);
            } else {
                scoreB = newScore;
                document.getElementById('team-b-score').textContent = scoreB;
                document.getElementById('score-b-circle').classList.add('pulse');
                setTimeout(() => document.getElementById('score-b-circle').classList.remove('pulse'), 300);
            }

            playSound(amount > 0 ? 'score' : 'undo');
            vibrate(amount > 0 ? [50] : [30, 30, 30]);
            checkSideChange();
            checkHighlights();
            checkGameEnd();
            saveMatchState();
        }

        /**
         * 撤销上一次得分
         */
        function undoScore() {
            if (!timerRunning) {
                showNotification('提示', '请先点击"开始比赛"按钮开始计时！');
                return;
            }
            
            if (scoreHistory.length === 0) {
                showNotification('提示', '没有可撤销的操作');
                return;
            }
            
            const lastAction = scoreHistory.pop();
            if (lastAction.team === 'a') {
                scoreA = lastAction.oldScore;
                document.getElementById('team-a-score').textContent = scoreA;
            } else {
                scoreB = lastAction.oldScore;
                document.getElementById('team-b-score').textContent = scoreB;
            }
            
            playSound('undo');
            vibrate([30, 30, 30]);
            saveMatchState();
        }

        /**
         * 检查是否需要换边
         */
        function checkSideChange() {
            if (!document.getElementById('side-change-alert').checked) return;
            
            const totalScore = scoreA + scoreB;
            const switchPoint = Math.floor(targetScore / 2) + 1;
            
            if (targetScore === 21 && totalScore === 11) {
                showNotification('换边提醒', '双方得分之和达到11分，请交换场地！');
            } else if (targetScore === 15 && totalScore === 8) {
                showNotification('换边提醒', '双方得分之和达到8分，请交换场地！');
            } else if (targetScore === 11 && totalScore === 6) {
                showNotification('换边提醒', '双方得分之和达到6分，请交换场地！');
            } else if (gameMode === 'custom' && totalScore === switchPoint) {
                showNotification('换边提醒', `双方得分之和达到${switchPoint}分，请交换场地！`);
            }
        }

        /**
         * 检查本局是否结束
         */
        function checkGameEnd() {
            const deuceMode = document.getElementById('deuce-mode').checked;
            let gameEnded = false;
            
            if (deuceMode) {
                if (scoreA >= 30 || scoreB >= 30) {
                    gameEnded = true;
                } else if ((scoreA >= targetScore || scoreB >= targetScore) && Math.abs(scoreA - scoreB) >= 2) {
                    gameEnded = true;
                }
            } else {
                if ((scoreA >= targetScore || scoreB >= targetScore) && Math.abs(scoreA - scoreB) >= 2) {
                    gameEnded = true;
                } else if (scoreA >= targetScore && scoreB >= targetScore) {
                    showNotification('平局', '双方同时达到目标分数，请继续比赛直到领先2分！');
                }
            }
            
            if (gameEnded) {
                endGame();
            }
        }

        /**
         * 结束本局
         */
        function endGame() {
            if (!timerRunning && scoreA === 0 && scoreB === 0) {
                showNotification('提示', '请先点击"开始比赛"按钮开始计时！');
                return;
            }
            
            let winner = '';
            if (scoreA > scoreB) {
                gamesWonA++;
                winner = document.getElementById('team-a-name').value || '己方';
                document.getElementById('score-a-circle').classList.add('winner');
            } else if (scoreB > scoreA) {
                gamesWonB++;
                winner = document.getElementById('team-b-name').value || '对方';
                document.getElementById('score-b-circle').classList.add('winner');
            } else {
                showNotification('平局', '双方比分相同，请继续比赛！');
                return;
            }
            
            gameScoresHistory.push(`${scoreA}-${scoreB}`);
            
            updateGamesWonDisplay();
            
            const bestOfThree = true;
            if (bestOfThree && (gamesWonA >= 2 || gamesWonB >= 2)) {
                if (timerRunning) {
                    clearInterval(timerInterval);
                    timerRunning = false;
                    document.getElementById('timer-button').innerHTML = '<span class="btn-icon">▶️</span><span class="btn-text">开始比赛</span>';
                }
                showNotification('比赛结束', `${winner} 获胜！\n最终比分: ${gamesWonA} : ${gamesWonB}`);
                document.getElementById('result-form').style.display = 'block';
                playSound('win');
                setTimeout(() => triggerCelebration(winner), 500);
            } else {
                showNotification('本局结束', `${winner} 赢得第 ${currentGame} 局！\n比分: ${scoreA} - ${scoreB}`);
                playSound('gameEnd');
                currentGame++;
                document.getElementById('current-game').textContent = `第 ${currentGame} 局`;
                resetCurrentGame();
            }
        }

        /**
         * 重置当前局比分
         */
        function resetCurrentGame() {
            scoreA = 0;
            scoreB = 0;
            scoreHistory = [];
            document.getElementById('team-a-score').textContent = '0';
            document.getElementById('team-b-score').textContent = '0';
            document.getElementById('score-a-circle').classList.remove('winner');
            document.getElementById('score-b-circle').classList.remove('winner');
            wasLeadingTeamA = null;
            saveMatchState();
        }

        /**
         * 重置整场比赛
         */
        function resetMatch() {
            const hasProgress = scoreA > 0 || scoreB > 0 || gamesWonA > 0 || gamesWonB > 0 || seconds > 0;
            
            if (hasProgress) {
                const currentScore = `${gamesWonA} : ${gamesWonB}`;
                const gameTime = document.getElementById('match-timer').textContent;
                const message = `确定要重置整场比赛吗？\n\n当前比分：${currentScore}\n比赛时长：${gameTime}\n\n此操作不可撤销！`;
                
                if (!confirm(message)) return;
            } else {
                if (!confirm('确定要重置比赛吗？')) return;
            }
            
            scoreA = 0;
            scoreB = 0;
            gamesWonA = 0;
            gamesWonB = 0;
            currentGame = 1;
            scoreHistory = [];
            gameScoresHistory = [];
            
            document.getElementById('team-a-score').textContent = '0';
            document.getElementById('team-b-score').textContent = '0';
            document.getElementById('score-a-circle').classList.remove('winner');
            document.getElementById('score-b-circle').classList.remove('winner');
            document.getElementById('current-game').textContent = '第 1 局';
            document.getElementById('result-form').style.display = 'none';
            
            updateGamesWonDisplay();
            resetTimer();
            resetHighlights();
            clearMatchState();
        }

        /**
         * 更新局分显示
         */
        function updateGamesWonDisplay() {
            const maxGames = 3;
            let htmlA = '';
            let htmlB = '';
            
            for (let i = 0; i < maxGames; i++) {
                htmlA += `<div class="game-dot ${i < gamesWonA ? 'won' : ''}"></div>`;
                htmlB += `<div class="game-dot ${i < gamesWonB ? 'won' : ''}"></div>`;
            }
            
            document.getElementById('team-a-games').innerHTML = htmlA;
            document.getElementById('team-b-games').innerHTML = htmlB;
            
            document.getElementById('games-score-a').textContent = gamesWonA;
            document.getElementById('games-score-b').textContent = gamesWonB;
        }

        /**
         * 编辑队伍名称
         * @param {string} team - 队伍标识
         */
        /**
         * 编辑队伍名称
         * @param {string} team - 队伍标识 ('a' 或 'b')
         */
        function editTeamName(team) {
            const currentName = team === 'a' ? teamNameA : teamNameB;
            showInputDialog('请输入队伍名称', currentName, function(newName) {
                if (newName && newName.trim()) {
                    if (team === 'a') {
                        teamNameA = newName.trim();
                        document.getElementById('team-a-name').textContent = teamNameA;
                    } else {
                        teamNameB = newName.trim();
                        document.getElementById('team-b-name').textContent = teamNameB;
                    }
                    saveMatchState();
                }
            });
        }

        // ==================== 比赛结果保存 ====================
        /**
         * 保存比赛结果
         */
        function saveMatchResult() {
            const teamANames = document.getElementById('team-a-names').value || teamNameA;
            const teamBNames = document.getElementById('team-b-names').value || teamNameB;
            
            const matchResult = {
                id: Date.now(),
                teamA: teamANames,
                teamB: teamBNames,
                scoreA: gamesWonA,
                scoreB: gamesWonB,
                gameScores: getGameScores(),
                duration: seconds,
                date: new Date().toISOString(),
                mode: gameMode,
                highlights: getHighlightsSummary()
            };
            
            const matchHistory = JSON.parse(localStorage.getItem('matchHistory') || '[]');
            matchHistory.unshift(matchResult);
            localStorage.setItem('matchHistory', JSON.stringify(matchHistory));
            
            const won = gamesWonA > gamesWonB;
            const perfectWin = checkPerfectWin();
            const hadDeuce = checkHadDeuce();
            updateMatchAchievements(won, perfectWin, hadDeuce);
            
            showNotification('保存成功', '比赛记录已保存！');
            loadHistory();
            initPlayerAbilitySelector();
            resetMatch();
        }

        /**
         * 检查是否有零封胜利
         */
        function checkPerfectWin() {
            return (scoreA === 0 && scoreB > 0) || (scoreB === 0 && scoreA > 0);
        }

        /**
         * 检查是否经历过加分赛
         */
        function checkHadDeuce() {
            return scoreA >= 20 && scoreB >= 20;
        }

        /**
         * 获取各局比分
         */
        function getGameScores() {
            return gameScoresHistory.join(', ');
        }

        /**
         * 分享比赛结果
         */
        function shareResult() {
            let winnerText = '';
            if (gamesWonA > gamesWonB) {
                winnerText = `🏆 获胜方: ${teamNameA}`;
            } else if (gamesWonB > gamesWonA) {
                winnerText = `🏆 获胜方: ${teamNameB}`;
            } else {
                winnerText = '🏆 比赛平局';
            }
            
            const resultText = `🏸 羽毛球比赛结果\n` +
                `📅 ${new Date().toLocaleString()}\n` +
                `👥 ${teamNameA} vs ${teamNameB}\n` +
                `📊 局分: ${gamesWonA} : ${gamesWonB}\n` +
                `⏱️ 比赛时长: ${document.getElementById('match-timer').textContent}\n` +
                winnerText;
            
            if (navigator.share) {
                navigator.share({
                    title: '羽毛球比赛结果',
                    text: resultText
                }).catch(err => console.log('分享取消'));
            } else {
                navigator.clipboard.writeText(resultText).then(() => {
                    showNotification('复制成功', '比赛结果已复制到剪贴板！');
                });
            }
        }

        // ==================== 历史记录功能 ====================
        /**
         * 加载历史记录
         */
        function loadHistory() {
            const matchHistory = JSON.parse(localStorage.getItem('matchHistory') || '[]');
            const historyList = document.getElementById('history-list');
            
            if (matchHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🏸</div>
                        <p>暂无比赛记录</p>
                        <p class="empty-state-hint">开始一场比赛后会自动记录在这里</p>
                    </div>`;
                updateStats([]);
                destroyCharts();
                document.getElementById('history-count').textContent = '0 场';
                return;
            }
            
            document.getElementById('history-count').textContent = `${matchHistory.length} 场`;
            
            historyList.innerHTML = matchHistory.slice(0, 20).map((match, index) => {
                const isWin = match.scoreA > match.scoreB;
                const resultClass = isWin ? 'win' : (match.scoreA < match.scoreB ? 'lose' : '');
                const duration = match.duration || 0;
                const minutes = Math.floor(duration / 60);
                const durationText = minutes > 0 ? `${minutes}分钟` : '';
                
                return `
                <div class="history-card ${resultClass}" onclick="showMatchDetail(${index})">
                    <div class="history-header">
                        <span class="history-date">${new Date(match.date).toLocaleString()}</span>
                        <span class="history-result">${match.scoreA} : ${match.scoreB}</span>
                    </div>
                    <div class="history-players">${match.teamA} vs ${match.teamB}</div>
                    <div class="history-meta">
                        ${durationText ? `<span>⏱️ ${durationText}</span>` : ''}
                        <span>${isWin ? '✅ 胜利' : (match.scoreA < match.scoreB ? '❌ 失败' : '🤝 平局')}</span>
                    </div>
                    ${match.highlights && match.highlights.length > 0 ? `
                        <div class="history-highlight-tags">
                            ${match.highlights.map(tag => `<span class="history-highlight-tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                </div>
            `}).join('');
            
            updateStats(matchHistory);
            
            if (currentScreen === 'history') {
                initCharts();
            }
        }

        /**
         * 显示比赛详情
         * @param {number} index - 比赛索引
         */
        function showMatchDetail(index) {
            const matchHistory = JSON.parse(localStorage.getItem('matchHistory') || '[]');
            const match = matchHistory[index];
            
            if (!match) return;
            
            const duration = match.duration || 0;
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            const durationText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            const isWin = match.scoreA > match.scoreB;
            
            const detailHtml = `
                <div class="match-detail-modal">
                    <div class="detail-header">
                        <h3>📋 比赛详情</h3>
                        <button class="detail-close-btn" onclick="closeMatchDetail()">✕</button>
                    </div>
                    <div class="detail-content">
                        <div class="detail-teams">
                            <div class="detail-team ${isWin ? 'winner' : ''}">
                                <div class="team-label">${match.teamA}</div>
                                <div class="team-score">${match.scoreA}</div>
                            </div>
                            <div class="detail-vs">VS</div>
                            <div class="detail-team ${!isWin && match.scoreA < match.scoreB ? 'winner' : ''}">
                                <div class="team-label">${match.teamB}</div>
                                <div class="team-score">${match.scoreB}</div>
                            </div>
                        </div>
                        <div class="detail-info">
                            <div class="info-item">
                                <span class="info-label">📅 日期</span>
                                <span class="info-value">${new Date(match.date).toLocaleString()}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">⏱️ 时长</span>
                                <span class="info-value">${durationText}</span>
                            </div>
                            ${match.gameScores ? `
                            <div class="info-item">
                                <span class="info-label">📊 各局比分</span>
                                <span class="info-value">${match.gameScores}</span>
                            </div>
                            ` : ''}
                        </div>
                        ${match.highlights && match.highlights.length > 0 ? `
                        <div class="detail-highlights">
                            <div class="highlights-title">✨ 高光时刻</div>
                            <div class="highlights-tags">
                                ${match.highlights.map(tag => `<span class="highlight-tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                        <div class="detail-actions">
                            <button class="btn btn-primary" onclick="shareHistoryMatch(${index})">📤 生成分享卡片</button>
                        </div>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.id = 'match-detail-overlay';
            modal.className = 'modal-overlay';
            modal.innerHTML = detailHtml;
            modal.onclick = function(e) {
                if (e.target === modal) closeMatchDetail();
            };
            document.body.appendChild(modal);
        }

        /**
         * 关闭比赛详情
         */
        function closeMatchDetail() {
            const overlay = document.getElementById('match-detail-overlay');
            if (overlay) overlay.remove();
        }

        /**
         * 从历史记录分享比赛
         * @param {number} index - 比赛记录索引
         */
        function shareHistoryMatch(index) {
            const matchHistory = JSON.parse(localStorage.getItem('matchHistory') || '[]');
            const match = matchHistory[index];
            
            if (!match) {
                showNotification('错误', '未找到比赛记录');
                return;
            }
            
            const minutes = Math.floor((match.duration || 0) / 60);
            const displaySeconds = (match.duration || 0) % 60;
            const durationText = `${minutes.toString().padStart(2, '0')}:${displaySeconds.toString().padStart(2, '0')}`;
            
            shareCardData = {
                teamA: match.teamA,
                teamB: match.teamB,
                scoreA: match.scoreA,
                scoreB: match.scoreB,
                gameScores: match.gameScores || '',
                duration: durationText,
                date: new Date(match.date).toLocaleDateString('zh-CN'),
                highlights: match.highlights || []
            };
            
            closeMatchDetail();
            renderShareCard();
            document.getElementById('share-card-modal').classList.add('show');
        }

        /**
         * 更新统计数据
         * @param {Array} matchHistory - 比赛历史记录
         */
        function updateStats(matchHistory) {
            const totalMatches = matchHistory.length;
            let wins = 0;
            let losses = 0;
            let totalDuration = 0;
            
            matchHistory.forEach(match => {
                if (match.scoreA > match.scoreB) wins++;
                else if (match.scoreA < match.scoreB) losses++;
                totalDuration += match.duration || 0;
            });
            
            document.getElementById('total-matches').textContent = totalMatches;
            document.getElementById('total-wins').textContent = wins;
            document.getElementById('total-losses').textContent = losses;
            document.getElementById('win-rate').textContent = totalMatches > 0 ? 
                Math.round(wins / totalMatches * 100) + '%' : '0%';
            document.getElementById('total-time').textContent = 
                Math.round(totalDuration / 3600) + 'h';
        }

        /**
         * 导出历史记录
         */
        function exportHistory() {
            const matchHistory = JSON.parse(localStorage.getItem('matchHistory') || '[]');
            const dataStr = JSON.stringify(matchHistory, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `羽毛球比赛记录_${new Date().toLocaleDateString()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        /**
         * 清空历史记录
         */
        function clearHistory() {
            if (!confirm('确定要清空所有比赛记录吗？此操作不可恢复！')) return;
            localStorage.removeItem('matchHistory');
            loadHistory();
            showNotification('已清空', '所有比赛记录已删除');
        }

        // ==================== 智能分组功能 ====================
        /**
         * 生成分组
         */
        function generateGroups() {
            const playersText = document.getElementById('players-list').value;
            if (!playersText.trim()) {
                showNotification('提示', '请输入参与人员');
                return;
            }
            
            let players = playersText.split('\n').filter(p => p.trim() !== '').map(p => p.trim());
            const mode = document.getElementById('group-mode').value;
            
            if (players.length < 4) {
                showNotification('提示', '至少需要4人才能分组');
                return;
            }
            
            let groups = [];
            let skills = [];
            
            if (mode === 'balanced') {
                const skillInputs = document.querySelectorAll('.skill-input-item input');
                if (skillInputs.length === players.length) {
                    skills = Array.from(skillInputs).map(input => parseInt(input.value) || 3);
                } else {
                    skills = players.map(() => 3);
                }
                groups = balancedGrouping(players, skills);
            } else if (mode === 'rotation') {
                groups = rotationGrouping(players);
            } else {
                groups = randomGrouping(players);
            }
            
            displayGroups(groups, mode, skills);
            saveGroupingHistory(players, mode, groups);
        }

        /**
         * 选择分组模式
         * @param {string} mode - 分组模式
         */
        function selectGroupMode(mode) {
            document.getElementById('group-mode').value = mode;
            
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`.mode-card[data-mode="${mode}"]`).classList.add('active');
            
            const skillContainer = document.getElementById('skill-input-container');
            if (mode === 'balanced') {
                skillContainer.style.display = 'block';
                updateSkillInputs();
            } else {
                skillContainer.style.display = 'none';
            }
        }

        /**
         * 更新实力等级输入框
         */
        function updateSkillInputs() {
            const playersText = document.getElementById('players-list').value;
            const players = playersText.split('\n').filter(p => p.trim() !== '').map(p => p.trim());
            const container = document.getElementById('skill-inputs');
            
            container.innerHTML = players.map((player, index) => `
                <div class="skill-input-item">
                    <span class="player-name">${player}</span>
                    <input type="number" min="1" max="5" value="3" data-index="${index}">
                </div>
            `).join('');
        }

        /**
         * 快速添加选手
         * @param {string} name - 选手名字
         */
        function quickAddPlayer(name) {
            const textarea = document.getElementById('players-list');
            const currentText = textarea.value.trim();
            if (currentText) {
                textarea.value = currentText + '\n' + name;
            } else {
                textarea.value = name;
            }
            updatePlayerCount();
            updateSkillInputs();
        }

        /**
         * 更新选手数量显示
         */
        function updatePlayerCount() {
            const playersText = document.getElementById('players-list').value;
            const players = playersText.split('\n').filter(p => p.trim() !== '');
            document.getElementById('player-count').textContent = players.length;
        }

        /**
         * 重新分组
         */
        function regenerateGroups() {
            generateGroups();
        }

        /**
         * 导出分组结果
         */
        function exportGroups() {
            const resultsContainer = document.getElementById('group-results');
            const groups = resultsContainer.querySelectorAll('.group-card');
            
            let text = '🏸 羽毛球分组结果\n';
            text += '==================\n\n';
            
            groups.forEach((group, index) => {
                const players = group.querySelectorAll('.group-player');
                const playerNames = Array.from(players).map(p => p.textContent.replace(/实力:\d/, '').trim());
                text += `第${index + 1}组：${playerNames.join(' & ')}\n`;
            });
            
            text += `\n生成时间：${new Date().toLocaleString()}`;
            
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `分组结果_${new Date().toISOString().slice(0, 10)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('导出成功', '分组结果已导出为文本文件');
        }

        /**
         * 保存分组历史
         */
        function saveGroupingHistory(players, mode, groups) {
            const history = JSON.parse(localStorage.getItem('groupingHistory') || '[]');
            history.unshift({
                date: new Date().toISOString(),
                players: players,
                mode: mode,
                modeName: mode === 'random' ? '随机分组' : mode === 'balanced' ? '实力平衡' : '轮换赛制',
                groups: groups
            });
            
            if (history.length > 10) history.pop();
            localStorage.setItem('groupingHistory', JSON.stringify(history));
            loadGroupingHistory();
        }

        /**
         * 加载分组历史
         */
        function loadGroupingHistory() {
            const history = JSON.parse(localStorage.getItem('groupingHistory') || '[]');
            const container = document.getElementById('grouping-history-list');
            
            if (history.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #6839E8; opacity: 0.6; padding: 20px;">暂无分组历史</div>';
                return;
            }
            
            container.innerHTML = history.map(item => `
                <div class="grouping-history-item">
                    <div class="grouping-history-info">
                        <div class="grouping-history-mode">${item.modeName}</div>
                        <div class="grouping-history-players">${item.players.join('、')}</div>
                    </div>
                    <div class="grouping-history-date">${new Date(item.date).toLocaleString()}</div>
                </div>
            `).join('');
        }

        /**
         * 清空分组历史
         */
        function clearGroupingHistory() {
            if (!confirm('确定要清空所有分组历史吗？')) return;
            localStorage.removeItem('groupingHistory');
            loadGroupingHistory();
            showNotification('已清空', '分组历史已清空');
        }

        /**
         * 随机分组
         * @param {Array} players - 玩家列表
         */
        function randomGrouping(players) {
            const shuffled = [...players];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            const groups = [];
            for (let i = 0; i < shuffled.length; i += 2) {
                if (i + 1 < shuffled.length) {
                    groups.push([
                        { name: shuffled[i], skill: 3 },
                        { name: shuffled[i + 1], skill: 3 }
                    ]);
                } else {
                    if (groups.length > 0) {
                        groups[groups.length - 1].push({ name: shuffled[i], skill: 3 });
                    }
                }
            }
            return groups;
        }

        /**
         * 实力平衡分组
         * @param {Array} players - 玩家列表
         * @param {Array} skills - 实力等级列表
         */
        function balancedGrouping(players, skills) {
            if (!skills || skills.length !== players.length) {
                skills = players.map(() => 3);
            }
            
            const playerWithSkill = players.map((p, i) => ({ name: p, skill: skills[i] }));
            playerWithSkill.sort((a, b) => b.skill - a.skill);
            
            const groups = [];
            const used = new Set();
            
            while (used.size < playerWithSkill.length) {
                const available = playerWithSkill.filter((_, i) => !used.has(i));
                if (available.length === 0) break;
                
                const strongest = available[0];
                const strongestIdx = playerWithSkill.findIndex((p, i) => !used.has(i) && p.name === strongest.name);
                used.add(strongestIdx);
                
                const remaining = playerWithSkill.filter((_, i) => !used.has(i));
                if (remaining.length > 0) {
                    const weakest = remaining[remaining.length - 1];
                    const weakestIdx = playerWithSkill.findIndex((p, i) => !used.has(i) && p.name === weakest.name);
                    used.add(weakestIdx);
                    groups.push([
                        { name: strongest.name, skill: strongest.skill },
                        { name: weakest.name, skill: weakest.skill }
                    ]);
                } else {
                    if (groups.length > 0) {
                        groups[groups.length - 1].push({ name: strongest.name, skill: strongest.skill });
                    }
                }
            }
            return groups;
        }

        /**
         * 轮换赛制分组
         * @param {Array} players - 玩家列表
         */
        function rotationGrouping(players) {
            const groups = [];
            for (let i = 0; i < players.length; i++) {
                for (let j = i + 1; j < players.length; j++) {
                    groups.push([
                        { name: players[i], skill: 3 },
                        { name: players[j], skill: 3 }
                    ]);
                }
            }
            return groups;
        }

        /**
         * 显示分组结果
         * @param {Array} groups - 分组结果
         * @param {string} mode - 分组模式
         * @param {Array} skills - 实力等级
         */
        function displayGroups(groups, mode, skills) {
            const resultsSection = document.getElementById('group-results-section');
            const resultsContainer = document.getElementById('group-results');
            const statsContainer = document.getElementById('group-stats');
            
            resultsSection.style.display = 'block';
            resultsContainer.innerHTML = '';
            
            groups.forEach((group, index) => {
                const groupCard = document.createElement('div');
                groupCard.className = 'group-card';
                
                const totalSkill = group.reduce((sum, p) => sum + (p.skill || 3), 0);
                
                groupCard.innerHTML = `
                    <div class="group-card-header">
                        <div class="group-number">第${index + 1}组</div>
                        ${mode === 'balanced' ? `<div class="group-skill-badge">综合实力: ${totalSkill}</div>` : ''}
                    </div>
                    <div class="group-players">
                        ${group.map(player => `
                            <div class="group-player">
                                ${player.name}
                                ${mode === 'balanced' ? `<span class="group-player-skill">实力:${player.skill}</span>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
                resultsContainer.appendChild(groupCard);
            });
            
            const totalGroups = groups.length;
            const totalPlayers = groups.reduce((sum, g) => sum + g.length, 0);
            const avgGroupSize = (totalPlayers / totalGroups).toFixed(1);
            
            statsContainer.innerHTML = `
                <div class="group-stat-item">
                    <div class="group-stat-value">${totalGroups}</div>
                    <div class="group-stat-label">总组数</div>
                </div>
                <div class="group-stat-item">
                    <div class="group-stat-value">${totalPlayers}</div>
                    <div class="group-stat-label">参与人数</div>
                </div>
                <div class="group-stat-item">
                    <div class="group-stat-value">${avgGroupSize}</div>
                    <div class="group-stat-label">平均每组人数</div>
                </div>
            `;
            
            localStorage.setItem('lastGroups', JSON.stringify(groups));
        }

        /**
         * 清空分组结果
         */
        function clearGroups() {
            document.getElementById('players-list').value = '';
            document.getElementById('group-results').innerHTML = '';
            document.getElementById('group-results-section').style.display = 'none';
            document.getElementById('player-count').textContent = '0';
            document.getElementById('skill-inputs').innerHTML = '';
        }

        // ==================== 费用计算功能 ====================
        /**
         * 生成参与人员选择框
         */
        // ==================== 费用计算功能 ====================
        /**
         * 选择费用类型
         * @param {string} type - 费用类型
         */
        function selectExpenseType(type) {
            document.getElementById('expense-type').value = type;
            document.querySelectorAll('.expense-type-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`.expense-type-card[data-type="${type}"]`).classList.add('active');
        }

        /**
         * 选择分摊模式
         * @param {string} mode - 分摊模式
         */
        function selectSplitMode(mode) {
            document.getElementById('split-mode').value = mode;
            document.querySelectorAll('.split-mode-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`.split-mode-card[data-mode="${mode}"]`).classList.add('active');
            
            const ratioContainer = document.getElementById('custom-ratio-container');
            if (mode === 'custom') {
                ratioContainer.style.display = 'block';
                updateRatioInputs();
            } else {
                ratioContainer.style.display = 'none';
            }
        }

        /**
         * 设置快速金额
         * @param {number} amount - 金额
         */
        function setQuickAmount(amount) {
            document.getElementById('total-amount').value = amount;
        }

        /**
         * 更新参与人数显示
         */
        function updateParticipantCount() {
            const playersText = document.getElementById('expense-players').value;
            const players = playersText.split('\n').filter(p => p.trim() !== '');
            document.getElementById('participant-count').textContent = players.length;
        }

        /**
         * 更新比例输入框
         */
        function updateRatioInputs() {
            const playersText = document.getElementById('expense-players').value;
            const players = playersText.split('\n').filter(p => p.trim() !== '');
            const container = document.getElementById('ratio-inputs');
            
            container.innerHTML = players.map((player, index) => `
                <div class="ratio-input-item">
                    <span class="player-name">${player}</span>
                    <input type="number" min="1" max="10" value="1" data-index="${index}">
                </div>
            `).join('');
        }

        /**
         * 计算费用分摊
         */
        function calculateExpense() {
            const expenseType = document.getElementById('expense-type').value;
            const totalAmount = parseFloat(document.getElementById('total-amount').value);
            const playersText = document.getElementById('expense-players').value;
            const splitMode = document.getElementById('split-mode').value;
            
            if (isNaN(totalAmount) || totalAmount <= 0) {
                showNotification('提示', '请输入有效的总金额');
                return;
            }
            
            const participants = playersText.split('\n').filter(p => p.trim() !== '').map(p => p.trim());
            
            if (participants.length === 0) {
                showNotification('提示', '请输入参与人员');
                return;
            }
            
            let summaryHtml = '';
            let detailsHtml = '';
            let ratios = [];
            
            if (splitMode === 'equal') {
                const perPerson = totalAmount / participants.length;
                
                summaryHtml = `
                    <div class="summary-row">
                        <span class="summary-label">费用类型</span>
                        <span class="summary-value">${expenseType}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">总金额</span>
                        <span class="summary-value summary-total">¥${totalAmount.toFixed(2)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">参与人数</span>
                        <span class="summary-value">${participants.length}人</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">人均费用</span>
                        <span class="summary-value summary-total">¥${perPerson.toFixed(2)}</span>
                    </div>
                `;
                
                detailsHtml = participants.map(p => `
                    <div class="expense-detail-item">
                        <span class="detail-name">${p}</span>
                        <span class="detail-amount">¥${perPerson.toFixed(2)}</span>
                    </div>
                `).join('');
                
            } else if (splitMode === 'custom') {
                const ratioInputs = document.querySelectorAll('#ratio-inputs input');
                ratios = Array.from(ratioInputs).map(input => parseFloat(input.value) || 1);
                
                if (ratios.length !== participants.length) {
                    ratios = participants.map(() => 1);
                }
                
                const totalRatio = ratios.reduce((sum, r) => sum + r, 0);
                const amounts = ratios.map(r => (totalAmount * r / totalRatio));
                
                summaryHtml = `
                    <div class="summary-row">
                        <span class="summary-label">费用类型</span>
                        <span class="summary-value">${expenseType}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">总金额</span>
                        <span class="summary-value summary-total">¥${totalAmount.toFixed(2)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">分摊比例</span>
                        <span class="summary-value">${ratios.join(' : ')}</span>
                    </div>
                `;
                
                detailsHtml = participants.map((p, i) => `
                    <div class="expense-detail-item">
                        <span class="detail-name">${p} (${ratios[i]}份)</span>
                        <span class="detail-amount">¥${amounts[i].toFixed(2)}</span>
                    </div>
                `).join('');
                
            } else if (splitMode === 'time') {
                const matchDuration = seconds || 60;
                const hourlyRate = totalAmount / (matchDuration / 60);
                const perPerson = totalAmount / participants.length;
                
                summaryHtml = `
                    <div class="summary-row">
                        <span class="summary-label">费用类型</span>
                        <span class="summary-value">${expenseType}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">总金额</span>
                        <span class="summary-value summary-total">¥${totalAmount.toFixed(2)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">比赛时长</span>
                        <span class="summary-value">${matchDuration}分钟</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">时均费用</span>
                        <span class="summary-value">¥${hourlyRate.toFixed(2)}/小时</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">人均费用</span>
                        <span class="summary-value summary-total">¥${perPerson.toFixed(2)}</span>
                    </div>
                `;
                
                detailsHtml = participants.map(p => `
                    <div class="expense-detail-item">
                        <span class="detail-name">${p}</span>
                        <span class="detail-amount">¥${perPerson.toFixed(2)}</span>
                    </div>
                `).join('');
            }
            
            document.getElementById('expense-summary').innerHTML = summaryHtml;
            document.getElementById('expense-details').innerHTML = detailsHtml;
            document.getElementById('expense-result-section').style.display = 'block';
            
            saveExpenseHistory(expenseType, totalAmount, participants, splitMode, ratios);
        }

        /**
         * 保存费用历史
         */
        function saveExpenseHistory(type, total, participants, splitMode, ratios) {
            const history = JSON.parse(localStorage.getItem('expenseHistory') || '[]');
            history.unshift({
                date: new Date().toISOString(),
                type: type,
                total: total,
                participants: participants,
                splitMode: splitMode,
                ratios: ratios
            });
            
            if (history.length > 20) history.pop();
            localStorage.setItem('expenseHistory', JSON.stringify(history));
            loadExpenseHistory();
        }

        /**
         * 加载费用历史
         */
        function loadExpenseHistory() {
            const history = JSON.parse(localStorage.getItem('expenseHistory') || '[]');
            const container = document.getElementById('expense-history-list');
            
            if (history.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #6839E8; opacity: 0.6; padding: 20px;">暂无分摊历史</div>';
                return;
            }
            
            container.innerHTML = history.map((item, index) => `
                <div class="expense-history-item" onclick="showExpenseDetail(${index})">
                    <div class="expense-history-info">
                        <div class="expense-history-type">${item.type}</div>
                        <div class="expense-history-amount">¥${item.total.toFixed(2)} · ${item.participants.length}人参与</div>
                    </div>
                    <div class="expense-history-date">${new Date(item.date).toLocaleString()}</div>
                </div>
            `).join('');
        }

        /**
         * 显示费用详情
         * @param {number} index - 历史记录索引
         */
        function showExpenseDetail(index) {
            const history = JSON.parse(localStorage.getItem('expenseHistory') || '[]');
            const item = history[index];
            
            if (!item) {
                showNotification('错误', '未找到该记录');
                return;
            }
            
            const splitModeName = item.splitMode === 'equal' ? '平均分摊' : item.splitMode === 'custom' ? '自定义比例' : '按时长';
            
            let perPerson = 0;
            let amounts = [];
            
            if (item.splitMode === 'equal' || item.splitMode === 'time') {
                perPerson = item.total / item.participants.length;
                amounts = item.participants.map(() => perPerson);
            } else if (item.splitMode === 'custom' && item.ratios && item.ratios.length > 0) {
                const totalRatio = item.ratios.reduce((sum, r) => sum + r, 0);
                amounts = item.ratios.map(r => (item.total * r / totalRatio));
            } else {
                perPerson = item.total / item.participants.length;
                amounts = item.participants.map(() => perPerson);
            }
            
            const detailsHtml = item.participants.map((p, i) => `
                <div class="expense-detail-item">
                    <span class="detail-name">${p}${item.ratios && item.ratios[i] ? ` (${item.ratios[i]}份)` : ''}</span>
                    <span class="detail-amount">¥${amounts[i].toFixed(2)}</span>
                </div>
            `).join('');
            
            const summaryHtml = `
                <div class="summary-row">
                    <span class="summary-label">费用类型</span>
                    <span class="summary-value">${item.type}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">总金额</span>
                    <span class="summary-value summary-total">¥${item.total.toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">分摊模式</span>
                    <span class="summary-value">${splitModeName}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">参与人数</span>
                    <span class="summary-value">${item.participants.length}人</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">时间</span>
                    <span class="summary-value">${new Date(item.date).toLocaleString()}</span>
                </div>
            `;
            
            document.getElementById('expense-detail-summary').innerHTML = summaryHtml;
            document.getElementById('expense-detail-list').innerHTML = detailsHtml;
            document.getElementById('expense-detail-modal').classList.add('show');
        }

        /**
         * 关闭费用详情模态框
         */
        function closeExpenseDetailModal() {
            document.getElementById('expense-detail-modal').classList.remove('show');
        }

        /**
         * 清空费用表单
         */
        function clearExpenseForm() {
            document.getElementById('total-amount').value = '';
            document.getElementById('expense-players').value = '';
            document.getElementById('participant-count').textContent = '0';
            document.getElementById('expense-result-section').style.display = 'none';
            document.getElementById('ratio-inputs').innerHTML = '';
        }

        /**
         * 清空费用历史
         */
        function clearExpenseHistory() {
            if (!confirm('确定要清空所有分摊历史吗？')) return;
            localStorage.removeItem('expenseHistory');
            loadExpenseHistory();
            showNotification('已清空', '分摊历史已清空');
        }

        /**
         * 复制费用结果
         */
        function copyExpenseResult() {
            const summary = document.getElementById('expense-summary').innerText;
            const details = document.getElementById('expense-details').innerText;
            const text = `费用分摊结果\n${summary}\n\n${details}`;
            
            navigator.clipboard.writeText(text).then(() => {
                showNotification('复制成功', '分摊结果已复制到剪贴板');
            }).catch(() => {
                showNotification('复制失败', '请手动选择复制');
            });
        }

        /**
         * 导出费用记录
         */
        function exportExpense() {
            const expenseHistory = JSON.parse(localStorage.getItem('expenseHistory') || '[]');
            
            let text = '💰 费用分摊记录\n';
            text += '==================\n\n';
            
            expenseHistory.forEach((item, index) => {
                text += `【${index + 1}】${item.type}\n`;
                text += `金额：¥${item.total.toFixed(2)}\n`;
                text += `参与人：${item.participants.join('、')}\n`;
                text += `时间：${new Date(item.date).toLocaleString()}\n\n`;
            });
            
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `费用分摊记录_${new Date().toISOString().slice(0, 10)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('导出成功', '费用记录已导出');
        }

        // ==================== 设置与数据管理 ====================
        /**
         * 保存设置
         */
        function saveSettings() {
            const settings = {
                gameMode: gameMode,
                targetScore: targetScore,
                bestOfThree: document.getElementById('best-of-three').checked,
                deuceMode: document.getElementById('deuce-mode').checked,
                soundEnabled: document.getElementById('sound-enabled').checked,
                vibrationEnabled: document.getElementById('vibration-enabled').checked,
                sideChangeAlert: document.getElementById('side-change-alert').checked
            };
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        /**
         * 加载设置
         */
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            if (settings.gameMode) {
                setGameMode(settings.gameMode);
            }
            if (settings.bestOfThree !== undefined) {
                document.getElementById('best-of-three').checked = settings.bestOfThree;
            }
            if (settings.deuceMode !== undefined) {
                document.getElementById('deuce-mode').checked = settings.deuceMode;
            }
            if (settings.soundEnabled !== undefined) {
                document.getElementById('sound-enabled').checked = settings.soundEnabled;
            }
            if (settings.vibrationEnabled !== undefined) {
                document.getElementById('vibration-enabled').checked = settings.vibrationEnabled;
            }
            if (settings.sideChangeAlert !== undefined) {
                document.getElementById('side-change-alert').checked = settings.sideChangeAlert;
            }
        }

        /**
         * 保存比赛状态
         */
        function saveMatchState() {
            const state = {
                scoreA, scoreB, gamesWonA, gamesWonB, currentGame, seconds,
                teamNameA, teamNameB, scoreHistory, gameScoresHistory, timerRunning
            };
            localStorage.setItem('matchState', JSON.stringify(state));
        }

        /**
         * 加载比赛状态
         */
        function loadMatchState() {
            const state = JSON.parse(localStorage.getItem('matchState') || '{}');
            if (state.scoreA !== undefined) {
                scoreA = state.scoreA;
                scoreB = state.scoreB;
                gamesWonA = state.gamesWonA || 0;
                gamesWonB = state.gamesWonB || 0;
                currentGame = state.currentGame || 1;
                seconds = state.seconds || 0;
                teamNameA = state.teamNameA || '己方';
                teamNameB = state.teamNameB || '对方';
                scoreHistory = state.scoreHistory || [];
                gameScoresHistory = state.gameScoresHistory || [];
                
                document.getElementById('team-a-score').textContent = scoreA;
                document.getElementById('team-b-score').textContent = scoreB;
                document.getElementById('team-a-name').textContent = teamNameA;
                document.getElementById('team-b-name').textContent = teamNameB;
                document.getElementById('current-game').textContent = `第 ${currentGame} 局`;
                document.getElementById('games-score').textContent = `${gamesWonA} : ${gamesWonB}`;
                
                const minutes = Math.floor(seconds / 60);
                const displaySeconds = seconds % 60;
                document.getElementById('match-timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${displaySeconds.toString().padStart(2, '0')}`;
            }
        }

        /**
         * 清除比赛状态
         */
        function clearMatchState() {
            localStorage.removeItem('matchState');
        }

        /**
         * 备份数据
         */
        function backupData() {
            const data = {
                matchHistory: JSON.parse(localStorage.getItem('matchHistory') || '[]'),
                expenseHistory: JSON.parse(localStorage.getItem('expenseHistory') || '[]'),
                settings: JSON.parse(localStorage.getItem('settings') || '{}'),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `羽毛球计分板备份_${new Date().toLocaleDateString()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('备份成功', '数据已导出为JSON文件');
        }

        /**
         * 恢复数据
         */
        function restoreData() {
            document.getElementById('restore-file').click();
        }

        /**
         * 处理恢复文件
         */
        function handleRestoreFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.matchHistory) {
                        localStorage.setItem('matchHistory', JSON.stringify(data.matchHistory));
                    }
                    if (data.expenseHistory) {
                        localStorage.setItem('expenseHistory', JSON.stringify(data.expenseHistory));
                    }
                    if (data.settings) {
                        localStorage.setItem('settings', JSON.stringify(data.settings));
                    }
                    
                    loadSettings();
                    loadHistory();
                    showNotification('恢复成功', '数据已成功恢复！');
                } catch (err) {
                    showNotification('恢复失败', '文件格式不正确');
                }
            };
            reader.readAsText(file);
        }

        /**
         * 清除所有数据
         */
        function clearAllData() {
            if (!confirm('确定要清除所有数据吗？此操作不可恢复！')) return;
            
            localStorage.clear();
            loadSettings();
            loadHistory();
            resetMatch();
            showNotification('已清空', '所有数据已删除');
        }

        // ==================== 声音与震动 ====================
        /**
         * 播放音效
         * @param {string} type - 音效类型
         */
        function playSound(type) {
            if (!document.getElementById('sound-enabled').checked) return;
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            const sounds = {
                score: { freq: 800, duration: 0.1 },
                undo: { freq: 400, duration: 0.15 },
                win: { freq: 1000, duration: 0.3 },
                gameEnd: { freq: 600, duration: 0.2 }
            };
            
            const sound = sounds[type] || sounds.score;
            oscillator.frequency.value = sound.freq;
            gainNode.gain.value = 0.3;
            
            oscillator.start();
            setTimeout(() => {
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + sound.duration);
                oscillator.stop(audioContext.currentTime + sound.duration);
            }, sound.duration * 1000);
        }

        /**
         * 震动反馈
         * @param {Array} pattern - 震动模式
         */
        function vibrate(pattern) {
            if (!document.getElementById('vibration-enabled').checked) return;
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }

        // ==================== 通知功能 ====================
        /**
         * 显示通知
         * @param {string} title - 标题
         * @param {string} message - 消息内容
         */
        function showNotification(title, message) {
            document.getElementById('notification-title').textContent = title;
            document.getElementById('notification-message').textContent = message;
            document.getElementById('notification').classList.add('show');
        }

        /**
         * 隐藏通知
         */
        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        // ==================== 输入对话框 ====================
        let inputDialogCallback = null;

        /**
         * 显示输入对话框
         * @param {string} title - 对话框标题
         * @param {string} defaultValue - 输入框默认值
         * @param {function} callback - 回调函数，参数为用户输入的值（取消时为null）
         */
        function showInputDialog(title, defaultValue, callback) {
            document.getElementById('input-dialog-title').textContent = title;
            const input = document.getElementById('input-dialog-input');
            input.value = defaultValue || '';
            document.getElementById('input-dialog').classList.add('show');
            inputDialogCallback = callback;
            setTimeout(() => input.focus(), 100);
        }

        /**
         * 隐藏输入对话框
         * @param {boolean} confirmed - 是否确认
         */
        function hideInputDialog(confirmed) {
            document.getElementById('input-dialog').classList.remove('show');
            if (inputDialogCallback) {
                const value = confirmed ? document.getElementById('input-dialog-input').value : null;
                inputDialogCallback(value);
                inputDialogCallback = null;
            }
        }

        // ==================== 天气功能 ====================
        /**
         * 初始化天气
         */
        function initWeather() {
            const API_KEY = "82844554Ie9i812G";
            const weatherContainer = document.getElementById('weather-container');
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        fetch(`https://api.yiketianqi.com/api?version=v61&appid=${API_KEY}&lat=${lat}&lon=${lon}`)
                            .then(res => res.json())
                            .then(data => {
                                if (data.code === 200) {
                                    weatherContainer.querySelector('.location').textContent = `${data.city} ${data.district}`;
                                    weatherContainer.querySelector('.temperature').textContent = `${data.temp} °C`;
                                    weatherContainer.querySelector('.condition').textContent = data.wea;
                                    weatherContainer.querySelector('.details').innerHTML = 
                                        `<span>湿度: ${data.humidity}%</span><span>风力: ${data.win_speed}</span>`;
                                    weatherContainer.classList.add('loaded');
                                }
                            })
                            .catch(() => {
                                weatherContainer.querySelector('.location').textContent = '天气获取失败';
                            });
                    },
                    () => {
                        weatherContainer.querySelector('.location').textContent = '位置权限未开启';
                    }
                );
            }
        }

        // ==================== 高光时刻记录系统 ====================
        let highlightMoments = [];
        let wasLeadingTeamA = null;
        let maxLeadA = 0;
        let maxLeadB = 0;

        /**
         * 记录高光时刻
         * @param {string} type - 高光类型
         * @param {string} message - 高光消息
         */
        function recordHighlight(type, message) {
            highlightMoments.push({
                type,
                message,
                timestamp: Date.now(),
                scoreA,
                scoreB,
                currentGame
            });
        }

        /**
         * 检查并记录高光时刻
         */
        function checkHighlights() {
            const deuceMode = document.getElementById('deuce-mode').checked;

            if (deuceMode && scoreA >= 20 && scoreB >= 20) {
                if (highlightMoments.filter(h => h.type === 'deuce' && h.currentGame === currentGame).length === 0) {
                    recordHighlight('deuce', '进入加分赛！');
                    showHighlightNotification('🎮', '加分赛！', '双方比分20平，进入加分赛！');
                }
            }

            if (scoreA >= targetScore - 1 || scoreB >= targetScore - 1) {
                const existingMatchPoint = highlightMoments.find(h => 
                    h.type === 'matchpoint' && h.currentGame === currentGame
                );
                if (!existingMatchPoint) {
                    const approachingTeam = scoreA >= targetScore - 1 ? teamNameA : teamNameB;
                    recordHighlight('matchpoint', `${approachingTeam} 赛点！`);
                    showHighlightNotification('⚡', '赛点！', `${approachingTeam} 拿到赛点！`);
                }
            }

            if (scoreA > 0 && scoreB > 0) {
                const currentLead = scoreA - scoreB;
                if (wasLeadingTeamA === null) {
                    wasLeadingTeamA = currentLead > 0;
                } else if (wasLeadingTeamA && currentLead < -5) {
                    recordHighlight('comeback', `${teamNameB} 大逆转！`);
                    showHighlightNotification('🔥', '大逆转！', `${teamNameB} 落后5分以上后反超！`);
                    wasLeadingTeamA = false;
                } else if (!wasLeadingTeamA && currentLead > 5) {
                    recordHighlight('comeback', `${teamNameA} 大逆转！`);
                    showHighlightNotification('🔥', '大逆转！', `${teamNameA} 落后5分以上后反超！`);
                    wasLeadingTeamA = true;
                }
            }

            if (scoreA > maxLeadA) maxLeadA = scoreA;
            if (scoreB > maxLeadB) maxLeadB = scoreB;
        }

        /**
         * 显示高光时刻通知
         * @param {string} icon - 图标
         * @param {string} title - 标题
         * @param {string} message - 消息
         */
        function showHighlightNotification(icon, title, message) {
            const existingBadge = document.querySelector('.highlight-badge');
            if (existingBadge) existingBadge.remove();

            const badge = document.createElement('div');
            badge.className = 'highlight-badge';
            badge.innerHTML = `
                <div class="highlight-icon">${icon}</div>
                <div class="highlight-text">
                    <div class="highlight-title">${title}</div>
                    <div class="highlight-desc">${message}</div>
                </div>
            `;
            document.body.appendChild(badge);

            setTimeout(() => {
                badge.style.animation = 'highlightSlideDown 0.5s ease-out forwards';
            }, 50);

            setTimeout(() => {
                badge.style.animation = 'highlightSlideUp 0.3s ease-in forwards';
                setTimeout(() => badge.remove(), 300);
            }, 3500);
        }

        /**
         * 重置高光时刻数据
         */
        function resetHighlights() {
            highlightMoments = [];
            wasLeadingTeamA = null;
            maxLeadA = 0;
            maxLeadB = 0;
        }

        /**
         * 保存高光时刻到比赛记录
         */
        function getHighlightsSummary() {
            const summary = [];
            
            if (highlightMoments.filter(h => h.type === 'deuce').length > 0) {
                summary.push('🎮 加分赛');
            }
            if (highlightMoments.filter(h => h.type === 'comeback').length > 0) {
                summary.push('🔥 大逆转');
            }
            if (scoreA === 0 || scoreB === 0) {
                summary.push('✨ 零封胜利');
            }
            
            return summary;
        }

        // ==================== 庆祝动画系统 ====================
        let currentShareTemplate = 1;
        let shareCardData = {};

        /**
         * 触发庆祝动画
         * @param {string} winnerName - 获胜者名称
         */
        function triggerCelebration(winnerName) {
            createConfetti();
            createFireworks();
            showVictoryBanner(winnerName);
        }

        /**
         * 创建彩带动画
         */
        function createConfetti() {
            const container = document.getElementById('confetti-container');
            const colors = ['#6839E8', '#27F05C', '#FFB800', '#FF4D4D', '#0133A4', '#FFFFFF'];
            
            for (let i = 0; i < 150; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = (Math.random() * 10 + 5) + 'px';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    
                    container.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 20);
            }
        }

        /**
         * 创建烟花动画
         */
        function createFireworks() {
            const container = document.getElementById('firework-container');
            const colors = ['#6839E8', '#27F05C', '#FFB800', '#FF4D4D', '#FFFFFF'];
            
            for (let f = 0; f < 5; f++) {
                setTimeout(() => {
                    const x = Math.random() * 80 + 10;
                    const y = Math.random() * 40 + 20;
                    
                    for (let i = 0; i < 30; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'firework-particle';
                        particle.style.left = x + '%';
                        particle.style.top = y + '%';
                        particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        
                        const angle = (i / 30) * Math.PI * 2;
                        const velocity = Math.random() * 200 + 100;
                        const dx = Math.cos(angle) * velocity;
                        const dy = Math.sin(angle) * velocity;
                        
                        particle.style.animationDuration = (Math.random() * 1 + 1) + 's';
                        particle.animate([
                            { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                            { transform: `translate(${dx}px, ${dy}px) scale(0)`, opacity: 0 }
                        ], {
                            duration: 1500,
                            easing: 'ease-out'
                        });
                        
                        container.appendChild(particle);
                        setTimeout(() => particle.remove(), 1500);
                    }
                }, f * 500);
            }
        }

        /**
         * 显示胜利横幅
         * @param {string} winnerName - 获胜者名称
         */
        function showVictoryBanner(winnerName) {
            const banner = document.getElementById('victory-banner');
            banner.querySelector('h2').textContent = winnerName + ' 获胜!';
            banner.style.display = 'block';
            
            setTimeout(() => {
                banner.style.display = 'none';
            }, 3000);
        }

        // ==================== 分享卡片系统 ====================
        /**
         * 打开分享卡片模态框
         */
        function openShareCardModal() {
            shareCardData = {
                teamA: document.getElementById('team-a-names').value || teamNameA,
                teamB: document.getElementById('team-b-names').value || teamNameB,
                scoreA: gamesWonA,
                scoreB: gamesWonB,
                gameScores: gameScoresHistory.join(', '),
                duration: document.getElementById('match-timer').textContent,
                date: new Date().toLocaleDateString('zh-CN')
            };
            
            renderShareCard();
            document.getElementById('share-card-modal').classList.add('show');
        }

        /**
         * 关闭分享卡片模态框
         */
        function closeShareCardModal() {
            document.getElementById('share-card-modal').classList.remove('show');
        }

        /**
         * 选择分享卡片模板
         * @param {number} template - 模板编号
         */
        function selectShareTemplate(template) {
            currentShareTemplate = template;
            document.querySelectorAll('.template-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.template-btn[data-template="${template}"]`).classList.add('active');
            renderShareCard();
        }

        /**
         * 渲染分享卡片
         */
        function renderShareCard() {
            const preview = document.getElementById('share-card-preview');
            const winner = shareCardData.scoreA > shareCardData.scoreB ? 'A' : 'B';
            const highlightsHtml = shareCardData.highlights && shareCardData.highlights.length > 0 
                ? `<div class="share-card-highlights">${shareCardData.highlights.map(tag => `<span class="share-card-highlight-tag">${tag}</span>`).join('')}</div>` 
                : '';
            
            let html = '';
            
            if (currentShareTemplate === 1) {
                html = `
                    <div class="share-card-template-1">
                        <div class="share-card-header">
                            <div class="share-card-logo">🏸 羽毛球极速记分板</div>
                            <div class="share-card-subtitle">精彩对决</div>
                        </div>
                        <div class="share-card-score">
                            <div class="share-card-team-names">
                                <div class="share-card-team-name">${shareCardData.teamA}</div>
                                <div class="share-card-vs">VS</div>
                                <div class="share-card-team-name">${shareCardData.teamB}</div>
                            </div>
                            <div class="share-card-score-display">
                                <div class="share-card-score-number ${winner === 'A' ? 'winner' : ''}">${shareCardData.scoreA}</div>
                                <div class="share-card-score-separator">:</div>
                                <div class="share-card-score-number ${winner === 'B' ? 'winner' : ''}">${shareCardData.scoreB}</div>
                            </div>
                        </div>
                        <div class="share-card-footer">
                            <div class="share-card-date">📅 ${shareCardData.date}</div>
                            <div class="share-card-duration">⏱️ 比赛时长 ${shareCardData.duration}</div>
                            ${highlightsHtml}
                        </div>
                    </div>
                `;
            } else if (currentShareTemplate === 2) {
                html = `
                    <div class="share-card-template-1" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="share-card-header">
                            <div class="share-card-logo">🔥 激情对决</div>
                            <div class="share-card-subtitle">羽毛球比赛</div>
                        </div>
                        <div class="share-card-score">
                            <div class="share-card-team-names">
                                <div class="share-card-team-name">${shareCardData.teamA}</div>
                                <div class="share-card-vs">VS</div>
                                <div class="share-card-team-name">${shareCardData.teamB}</div>
                            </div>
                            <div class="share-card-score-display">
                                <div class="share-card-score-number ${winner === 'A' ? 'winner' : ''}">${shareCardData.scoreA}</div>
                                <div class="share-card-score-separator">:</div>
                                <div class="share-card-score-number ${winner === 'B' ? 'winner' : ''}">${shareCardData.scoreB}</div>
                            </div>
                        </div>
                        <div class="share-card-footer">
                            <div class="share-card-date">🏆 ${winner === 'A' ? shareCardData.teamA : shareCardData.teamB} 获胜!</div>
                            <div class="share-card-duration">⏱️ ${shareCardData.duration}</div>
                            ${highlightsHtml}
                        </div>
                    </div>
                `;
            } else {
                html = `
                    <div class="share-card-template-1" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="share-card-header">
                            <div class="share-card-logo">🎮 快乐羽毛球</div>
                            <div class="share-card-subtitle">精彩瞬间</div>
                        </div>
                        <div class="share-card-score">
                            <div class="share-card-team-names">
                                <div class="share-card-team-name">${shareCardData.teamA}</div>
                                <div class="share-card-vs">VS</div>
                                <div class="share-card-team-name">${shareCardData.teamB}</div>
                            </div>
                            <div class="share-card-score-display">
                                <div class="share-card-score-number ${winner === 'A' ? 'winner' : ''}">${shareCardData.scoreA}</div>
                                <div class="share-card-score-separator">:</div>
                                <div class="share-card-score-number ${winner === 'B' ? 'winner' : ''}">${shareCardData.scoreB}</div>
                            </div>
                        </div>
                        <div class="share-card-footer">
                            <div class="share-card-date">💪 继续加油!</div>
                            <div class="share-card-duration">${shareCardData.date} · ${shareCardData.duration}</div>
                            ${highlightsHtml}
                        </div>
                    </div>
                `;
            }
            
            preview.innerHTML = html;
        }

        /**
         * 下载分享卡片为图片
         */
        async function downloadShareCard() {
            const preview = document.getElementById('share-card-preview');
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '生成中...';
            btn.disabled = true;
            
            try {
                const canvas = await html2canvas(preview, {
                    scale: 2,
                    backgroundColor: null,
                    useCORS: true,
                    logging: false
                });
                
                const link = document.createElement('a');
                const timestamp = new Date().toISOString().slice(0, 10);
                link.download = `羽毛球比赛_${shareCardData.teamA}vs${shareCardData.teamB}_${timestamp}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                showNotification('保存成功', '分享卡片已保存到本地！');
            } catch (error) {
                console.error('保存失败:', error);
                showNotification('保存失败', '请使用截图功能手动保存');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        // ==================== 成就系统功能 ====================
        /**
         * 初始化成就系统
         */
        function initAchievements() {
            renderAchievements();
            updateAchievementsSummary();
        }

        /**
         * 加载成就数据
         */
        function loadAchievements() {
            const saved = localStorage.getItem('unlockedAchievements');
            if (saved) {
                unlockedAchievements = JSON.parse(saved);
            }
            
            const stats = localStorage.getItem('achievementStats');
            if (stats) {
                const parsed = JSON.parse(stats);
                totalMatches = parsed.totalMatches || 0;
                totalWins = parsed.totalWins || 0;
                currentStreak = parsed.currentStreak || 0;
                totalDuration = parsed.totalDuration || 0;
                deuceCount = parsed.deuceCount || 0;
            }
        }

        /**
         * 保存成就数据
         */
        function saveAchievements() {
            localStorage.setItem('unlockedAchievements', JSON.stringify(unlockedAchievements));
            localStorage.setItem('achievementStats', JSON.stringify({
                totalMatches,
                totalWins,
                currentStreak,
                totalDuration,
                deuceCount
            }));
        }

        /**
         * 渲染成就列表
         */
        function renderAchievements() {
            const matchContainer = document.getElementById('match-achievements');
            const winContainer = document.getElementById('win-achievements');
            const durationContainer = document.getElementById('duration-achievements');
            const specialContainer = document.getElementById('special-achievements');
            
            if (!matchContainer) return;
            
            const matchAchievements = achievementsList.filter(a => a.type === 'match');
            const winAchievements = achievementsList.filter(a => a.type === 'win' || a.type === 'streak');
            const durationAchievements = achievementsList.filter(a => a.type === 'duration');
            const specialAchievements = achievementsList.filter(a => a.type === 'perfect' || a.type === 'deuce');
            
            matchContainer.innerHTML = renderAchievementCards(matchAchievements);
            winContainer.innerHTML = renderAchievementCards(winAchievements);
            durationContainer.innerHTML = renderAchievementCards(durationAchievements);
            specialContainer.innerHTML = renderAchievementCards(specialAchievements);
        }

        /**
         * 渲染成就卡片
         */
        function renderAchievementCards(achievements) {
            return achievements.map(achievement => {
                const unlocked = unlockedAchievements.includes(achievement.id);
                return `
                    <div class="achievement-card ${unlocked ? 'unlocked' : 'locked'}">
                        <div class="achievement-card-icon">${unlocked ? achievement.icon : '🔒'}</div>
                        <div class="achievement-card-title">${achievement.title}</div>
                        <div class="achievement-card-desc">${achievement.desc}</div>
                    </div>
                `;
            }).join('');
        }

        /**
         * 更新成就统计摘要
         */
        function updateAchievementsSummary() {
            const unlockedCount = unlockedAchievements.length;
            const totalCount = achievementsList.length;
            const progress = Math.round((unlockedCount / totalCount) * 100);
            
            const unlockedEl = document.getElementById('achievements-unlocked');
            const progressEl = document.getElementById('achievements-progress');
            const totalEl = document.getElementById('achievements-total');
            const ringEl = document.getElementById('achievement-progress-ring');
            
            if (unlockedEl) unlockedEl.textContent = unlockedCount;
            if (progressEl) progressEl.textContent = progress + '%';
            if (totalEl) totalEl.textContent = totalCount;
            
            if (ringEl) {
                const circumference = 283;
                const offset = circumference - (progress / 100) * circumference;
                ringEl.style.strokeDashoffset = offset;
            }
        }

        /**
         * 检查并解锁成就
         * @param {string} type - 成就类型
         * @param {any} value - 当前值
         */
        function checkAndUnlockAchievements(type, value) {
            achievementsList.forEach(achievement => {
                if (achievement.type === type && !unlockedAchievements.includes(achievement.id)) {
                    if (value >= achievement.value) {
                        unlockAchievement(achievement);
                    }
                }
            });
        }

        /**
         * 解锁成就
         * @param {object} achievement - 成就对象
         */
        function unlockAchievement(achievement) {
            if (unlockedAchievements.includes(achievement.id)) return;
            
            unlockedAchievements.push(achievement.id);
            saveAchievements();
            
            showAchievementBadge(achievement);
            renderAchievements();
            updateAchievementsSummary();
        }

        /**
         * 显示成就解锁徽章
         * @param {object} achievement - 成就对象
         */
        function showAchievementBadge(achievement) {
            const badge = document.getElementById('achievement-badge');
            if (!badge) return;
            
            document.getElementById('achievement-title').textContent = achievement.title;
            document.getElementById('achievement-desc').textContent = achievement.desc;
            badge.querySelector('.achievement-icon').textContent = achievement.icon;
            badge.style.display = 'flex';
            
            setTimeout(() => {
                badge.style.display = 'none';
            }, 4000);
        }

        /**
         * 更新比赛成就统计
         * @param {boolean} won - 是否获胜
         * @param {boolean} perfectWin - 是否零封
         * @param {boolean} hadDeuce - 是否经历加分赛
         */
        function updateMatchAchievements(won, perfectWin, hadDeuce) {
            totalMatches++;
            totalDuration += seconds;
            
            if (won) {
                totalWins++;
                currentStreak++;
            } else {
                currentStreak = 0;
            }
            
            if (hadDeuce) {
                deuceCount++;
            }
            
            saveAchievements();
            
            checkAndUnlockAchievements('match', totalMatches);
            checkAndUnlockAchievements('win', totalWins);
            checkAndUnlockAchievements('streak', currentStreak);
            checkAndUnlockAchievements('duration', totalDuration);
            checkAndUnlockAchievements('deuce', deuceCount);
            
            if (perfectWin) {
                const perfectAchievement = achievementsList.find(a => a.type === 'perfect');
                if (perfectAchievement) {
                    unlockAchievement(perfectAchievement);
                }
            }
        }

        // ==================== 统计图表系统 ====================
        let monthlyChart = null;
        let winLossChart = null;
        let winRateTrendChart = null;
        let durationChart = null;

        /**
         * 初始化所有图表
         */
        function initCharts() {
            const matchHistory = JSON.parse(localStorage.getItem('matchHistory') || '[]');
            if (matchHistory.length === 0) return;

            createMonthlyChart(matchHistory);
            createWinLossChart(matchHistory);
            createWinRateTrendChart(matchHistory);
            createDurationChart(matchHistory);
        }

        /**
         * 创建月度比赛趋势图
         * @param {Array} matchHistory - 比赛历史记录
         */
        function createMonthlyChart(matchHistory) {
            const ctx = document.getElementById('monthlyChart');
            if (!ctx) return;

            if (monthlyChart) {
                monthlyChart.destroy();
            }

            const monthlyData = {};
            matchHistory.forEach(match => {
                const date = new Date(match.date);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[monthKey] = (monthlyData[monthKey] || 0) + 1;
            });

            const labels = Object.keys(monthlyData).slice(-6);
            const data = labels.map(label => monthlyData[label]);

            monthlyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '比赛场数',
                        data: data,
                        borderColor: '#6839E8',
                        backgroundColor: 'rgba(104, 57, 232, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#6839E8',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        /**
         * 创建胜负分布饼图
         * @param {Array} matchHistory - 比赛历史记录
         */
        function createWinLossChart(matchHistory) {
            const ctx = document.getElementById('winLossChart');
            if (!ctx) return;

            if (winLossChart) {
                winLossChart.destroy();
            }

            let wins = 0;
            let losses = 0;

            matchHistory.forEach(match => {
                if (match.scoreA > match.scoreB) {
                    wins++;
                } else {
                    losses++;
                }
            });

            winLossChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['胜利', '失败'],
                    datasets: [{
                        data: [wins, losses],
                        backgroundColor: [
                            '#27F05C',
                            '#FF4D4D'
                        ],
                        borderColor: [
                            '#fff',
                            '#fff'
                        ],
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        /**
         * 创建胜率变化趋势图
         * @param {Array} matchHistory - 比赛历史记录
         */
        function createWinRateTrendChart(matchHistory) {
            const ctx = document.getElementById('winRateTrendChart');
            if (!ctx) return;

            if (winRateTrendChart) {
                winRateTrendChart.destroy();
            }

            const sortedHistory = [...matchHistory].reverse();
            let cumulativeWins = 0;
            const winRates = [];
            const labels = [];

            sortedHistory.forEach((match, index) => {
                if (match.scoreA > match.scoreB) {
                    cumulativeWins++;
                }
                const winRate = Math.round((cumulativeWins / (index + 1)) * 100);
                winRates.push(winRate);
                labels.push(`#${index + 1}`);
            });

            const recentLabels = labels.slice(-10);
            const recentWinRates = winRates.slice(-10);

            winRateTrendChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: recentLabels,
                    datasets: [{
                        label: '胜率 (%)',
                        data: recentWinRates,
                        backgroundColor: 'rgba(39, 240, 92, 0.6)',
                        borderColor: '#27F05C',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        /**
         * 创建比赛时长分布图
         * @param {Array} matchHistory - 比赛历史记录
         */
        function createDurationChart(matchHistory) {
            const ctx = document.getElementById('durationChart');
            if (!ctx) return;

            if (durationChart) {
                durationChart.destroy();
            }

            const durationRanges = {
                '0-10分钟': 0,
                '10-20分钟': 0,
                '20-30分钟': 0,
                '30-40分钟': 0,
                '40分钟以上': 0
            };

            matchHistory.forEach(match => {
                const minutes = (match.duration || 0) / 60;
                if (minutes < 10) {
                    durationRanges['0-10分钟']++;
                } else if (minutes < 20) {
                    durationRanges['10-20分钟']++;
                } else if (minutes < 30) {
                    durationRanges['20-30分钟']++;
                } else if (minutes < 40) {
                    durationRanges['30-40分钟']++;
                } else {
                    durationRanges['40分钟以上']++;
                }
            });

            const labels = Object.keys(durationRanges);
            const data = Object.values(durationRanges);

            durationChart = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            'rgba(104, 57, 232, 0.7)',
                            'rgba(39, 240, 92, 0.7)',
                            'rgba(255, 184, 0, 0.7)',
                            'rgba(1, 51, 164, 0.7)',
                            'rgba(255, 77, 77, 0.7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        /**
         * 销毁所有图表
         */
        function destroyCharts() {
            if (monthlyChart) {
                monthlyChart.destroy();
                monthlyChart = null;
            }
            if (winLossChart) {
                winLossChart.destroy();
                winLossChart = null;
            }
            if (winRateTrendChart) {
                winRateTrendChart.destroy();
                winRateTrendChart = null;
            }
            if (durationChart) {
                durationChart.destroy();
                durationChart = null;
            }
        }

        // ==================== 排行榜系统 ====================
        let currentLeaderboardType = 'wins';

        // ==================== 头像系统 ====================
        const avatarEmojis = ['😀', '😎', '🤩', '🥳', '😴', '🤔', '😤', '😱', '🤗', '😇', '🤠', '🥸', '🦸', '🧙', '🧑‍🎤', '👨‍🎨', '👩‍🎓', '🧑‍🍳', '🦊', '🐱', '🐶', '🐼', '🦄', '🐲', '🐯', '🦁', '🐻', '🐨', '🦝', '🦊', '🐰', '🐸'];
        let selectedAvatar = '😀';
        let playerAvatars = {};

        /**
         * 初始化头像系统
         */
        function initAvatars() {
            loadAvatars();
            renderAvatarLibrary();
        }

        /**
         * 加载头像数据
         */
        function loadAvatars() {
            const saved = localStorage.getItem('playerAvatars');
            if (saved) {
                playerAvatars = JSON.parse(saved);
            }
        }

        /**
         * 保存头像数据
         */
        function saveAvatars() {
            localStorage.setItem('playerAvatars', JSON.stringify(playerAvatars));
        }

        /**
         * 渲染设置页面的头像库
         */
        function renderAvatarLibrary() {
            const library = document.getElementById('avatar-library');
            if (!library) return;

            const html = Object.entries(playerAvatars).map(([name, avatar]) => `
                <div class="avatar-item" title="${name}">
                    ${avatar}
                </div>
            `).join('');

            library.innerHTML = html || `<div style="grid-column: 1/-1; text-align: center; opacity: 0.6; padding: 20px;">还没有设置头像，点击"管理选手头像"开始设置！</div>`;
        }

        /**
         * 打开头像管理模态框
         */
        function openAvatarManager() {
            const modal = document.getElementById('avatar-manager-modal');
            const selector = document.getElementById('avatar-selector');
            
            selector.innerHTML = avatarEmojis.map((emoji, index) => `
                <div class="avatar-option ${index === 0 ? 'selected' : ''}" data-avatar="${emoji}" onclick="selectAvatar('${emoji}', this)">
                    ${emoji}
                </div>
            `).join('');
            
            selectedAvatar = avatarEmojis[0];
            document.getElementById('avatar-player-name').value = '';
            modal.classList.add('show');
        }

        /**
         * 关闭头像管理模态框
         */
        function closeAvatarManager() {
            document.getElementById('avatar-manager-modal').classList.remove('show');
        }

        /**
         * 选择头像
         * @param {string} avatar - 头像emoji
         * @param {HTMLElement} element - 头像元素
         */
        function selectAvatar(avatar, element) {
            selectedAvatar = avatar;
            document.querySelectorAll('.avatar-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        }

        /**
         * 保存选手头像
         */
        function savePlayerAvatar() {
            const nameInput = document.getElementById('avatar-player-name');
            const playerName = nameInput.value.trim();
            
            if (!playerName) {
                showNotification('提示', '请输入选手名称！');
                return;
            }
            
            playerAvatars[playerName] = selectedAvatar;
            saveAvatars();
            renderAvatarLibrary();
            closeAvatarManager();
            showNotification('保存成功', `${playerName} 的头像已设置！`);
        }

        /**
         * 获取选手头像
         * @param {string} playerName - 选手名称
         * @returns {string} 头像emoji
         */
        function getPlayerAvatar(playerName) {
            return playerAvatars[playerName] || '🏸';
        }

        // ==================== 选手能力评估系统 ====================
        /**
         * 初始化选手选择器
         */
        function initPlayerAbilitySelector() {
            const matchHistory = JSON.parse(localStorage.getItem('matchHistory') || '[]');
            const select = document.getElementById('ability-player-select');
            
            if (!select || matchHistory.length === 0) return;

            const playerStats = {};
            
            matchHistory.forEach(match => {
                const playersA = match.teamA.split(/[\/、]/).map(p => p.trim());
                const playersB = match.teamB.split(/[\/、]/).map(p => p.trim());
                
                playersA.forEach(player => {
                    if (!playerStats[player]) {
                        playerStats[player] = { wins: 0, matches: 0, duration: 0 };
                    }
                    playerStats[player].matches++;
                    playerStats[player].duration += match.duration || 0;
                    if (match.scoreA > match.scoreB) playerStats[player].wins++;
                });
                
                playersB.forEach(player => {
                    if (!playerStats[player]) {
                        playerStats[player] = { wins: 0, matches: 0, duration: 0 };
                    }
                    playerStats[player].matches++;
                    playerStats[player].duration += match.duration || 0;
                    if (match.scoreB > match.scoreA) playerStats[player].wins++;
                });
            });

            const players = Object.keys(playerStats);
            select.innerHTML = `<option value="">选择选手...</option>` + 
                players.map(p => `<option value="${p}">${p}</option>`).join('');
        }

        /**
         * 渲染选手能力分析
         */
        function renderPlayerAbility() {
            const select = document.getElementById('ability-player-select');
            const display = document.getElementById('ability-display');
            const noDataHint = document.getElementById('no-data-hint');
            const playerName = select.value;
            
            if (!playerName) {
                display.style.display = 'none';
                noDataHint.style.display = 'block';
                return;
            }

            noDataHint.style.display = 'none';
            display.style.display = 'block';

            const matchHistory = JSON.parse(localStorage.getItem('matchHistory') || '[]');
            
            let wins = 0;
            let losses = 0;
            let matches = 0;
            let totalDuration = 0;
            let currentStreak = 0;
            let maxStreak = 0;
            let maxWinStreak = 0;
            let maxLoseStreak = 0;
            let currentWinStreak = 0;
            let currentLoseStreak = 0;
            const recentMatches = [];
            let totalScoreFor = 0;
            let totalScoreAgainst = 0;

            matchHistory.forEach(match => {
                const playersA = match.teamA.split(/[\/、]/).map(p => p.trim());
                const playersB = match.teamB.split(/[\/、]/).map(p => p.trim());
                
                if (playersA.includes(playerName) || playersB.includes(playerName)) {
                    matches++;
                    totalDuration += match.duration || 0;
                    
                    const aWon = match.scoreA > match.scoreB;
                    const won = (playersA.includes(playerName) && aWon) || 
                               (playersB.includes(playerName) && !aWon);
                    
                    if (won) {
                        wins++;
                        currentWinStreak++;
                        currentLoseStreak = 0;
                        if (currentWinStreak > maxWinStreak) {
                            maxWinStreak = currentWinStreak;
                        }
                    } else {
                        losses++;
                        currentLoseStreak++;
                        currentWinStreak = 0;
                        if (currentLoseStreak > maxLoseStreak) {
                            maxLoseStreak = currentLoseStreak;
                        }
                    }

                    if (playersA.includes(playerName)) {
                        totalScoreFor += match.scoreA;
                        totalScoreAgainst += match.scoreB;
                    } else {
                        totalScoreFor += match.scoreB;
                        totalScoreAgainst += match.scoreA;
                    }

                    recentMatches.unshift({
                        date: new Date(match.date).toLocaleDateString(),
                        won: won,
                        score: `${match.scoreA} : ${match.scoreB}`,
                        opponent: playersA.includes(playerName) ? match.teamB : match.teamA
                    });
                }
            });

            const winRate = matches > 0 ? Math.round((wins / matches) * 100) : 0;
            const avgDuration = matches > 0 ? Math.round(totalDuration / matches / 60) : 0;
            const totalHours = Math.round(totalDuration / 3600 * 10) / 10;
            const avgScoreFor = matches > 0 ? (totalScoreFor / matches).toFixed(1) : 0;
            const avgScoreAgainst = matches > 0 ? (totalScoreAgainst / matches).toFixed(1) : 0;

            document.getElementById('player-name-display').textContent = playerName;

            const statsGrid = document.getElementById('ability-stats-grid');
            statsGrid.innerHTML = `
                <div class="ability-stat-card">
                    <div class="ability-stat-value">${matches}</div>
                    <div class="ability-stat-label">🎯 总场次</div>
                </div>
                <div class="ability-stat-card">
                    <div class="ability-stat-value">${wins}</div>
                    <div class="ability-stat-label">🏆 胜场</div>
                </div>
                <div class="ability-stat-card">
                    <div class="ability-stat-value">${losses}</div>
                    <div class="ability-stat-label">💔 负场</div>
                </div>
                <div class="ability-stat-card">
                    <div class="ability-stat-value">${winRate}%</div>
                    <div class="ability-stat-label">📈 胜率</div>
                </div>
                <div class="ability-stat-card">
                    <div class="ability-stat-value">${totalHours}h</div>
                    <div class="ability-stat-label">⏱️ 总时长</div>
                </div>
                <div class="ability-stat-card">
                    <div class="ability-stat-value">${avgDuration}m</div>
                    <div class="ability-stat-label">⏰ 场均时长</div>
                </div>
                <div class="ability-stat-card">
                    <div class="ability-stat-value">${maxWinStreak}</div>
                    <div class="ability-stat-label">🔥 最长连胜</div>
                </div>
                <div class="ability-stat-card">
                    <div class="ability-stat-value">${maxLoseStreak}</div>
                    <div class="ability-stat-label">❄️ 最长连败</div>
                </div>
                <div class="ability-stat-card">
                    <div class="ability-stat-value">${avgScoreFor}</div>
                    <div class="ability-stat-label">⚔️ 场均得分</div>
                </div>
                <div class="ability-stat-card">
                    <div class="ability-stat-value">${avgScoreAgainst}</div>
                    <div class="ability-stat-label">🛡️ 场均失分</div>
                </div>
            `;

            const allPlayerStats = calculateAllPlayerStats(matchHistory);
            const ranks = calculatePlayerRanks(playerName, allPlayerStats);
            
            const rankCards = document.getElementById('rank-cards');
            rankCards.innerHTML = `
                <div class="rank-card ${ranks.wins <= 1 ? 'top-1' : ranks.wins <= 3 ? 'top-3' : ranks.wins <= 5 ? 'top-5' : ''}">
                    <div class="rank-value">#${ranks.wins}</div>
                    <div class="rank-label">胜场排名</div>
                </div>
                <div class="rank-card ${ranks.matches <= 1 ? 'top-1' : ranks.matches <= 3 ? 'top-3' : ranks.matches <= 5 ? 'top-5' : ''}">
                    <div class="rank-value">#${ranks.matches}</div>
                    <div class="rank-label">参赛排名</div>
                </div>
                <div class="rank-card ${ranks.winRate <= 1 ? 'top-1' : ranks.winRate <= 3 ? 'top-3' : ranks.winRate <= 5 ? 'top-5' : ''}">
                    <div class="rank-value">#${ranks.winRate}</div>
                    <div class="rank-label">胜率排名</div>
                </div>
                <div class="rank-card ${ranks.duration <= 1 ? 'top-1' : ranks.duration <= 3 ? 'top-3' : ranks.duration <= 5 ? 'top-5' : ''}">
                    <div class="rank-value">#${ranks.duration}</div>
                    <div class="rank-label">时长排名</div>
                </div>
            `;

            const recentContainer = document.getElementById('recent-matches');
            const recent5 = recentMatches.slice(0, 5);
            if (recent5.length > 0) {
                recentContainer.innerHTML = recent5.map(m => `
                    <div class="recent-match-item ${m.won ? 'win' : 'lose'}">
                        <div>
                            <div class="recent-match-date">${m.date}</div>
                            <div style="font-size: 0.85rem; color: #0133A4; opacity: 0.7;">vs ${m.opponent}</div>
                        </div>
                        <div class="recent-match-result ${m.won ? 'win' : 'lose'}">
                            ${m.won ? '胜' : '负'} ${m.score}
                        </div>
                    </div>
                `).join('');
            } else {
                recentContainer.innerHTML = '<div style="text-align: center; color: #6839E8; opacity: 0.6; padding: 20px;">暂无比赛记录</div>';
            }

            const tags = generateRealTags(wins, matches, winRate, totalDuration, maxWinStreak);
            const tagsContainer = document.getElementById('ability-tags');
            if (tags.length > 0) {
                tagsContainer.innerHTML = tags.map(tag => 
                    `<span class="ability-tag">${tag}</span>`
                ).join('');
            } else {
                tagsContainer.innerHTML = '<span class="ability-tag">🏸 羽毛球爱好者</span>';
            }
        }

        function calculateAllPlayerStats(matchHistory) {
            const playerStats = {};
            
            matchHistory.forEach(match => {
                const playersA = match.teamA.split(/[\/、]/).map(p => p.trim());
                const playersB = match.teamB.split(/[\/、]/).map(p => p.trim());
                const aWon = match.scoreA > match.scoreB;
                
                [...playersA, ...playersB].forEach(player => {
                    if (!playerStats[player]) {
                        playerStats[player] = { wins: 0, matches: 0, duration: 0 };
                    }
                    playerStats[player].matches++;
                    playerStats[player].duration += match.duration || 0;
                    
                    const won = (playersA.includes(player) && aWon) || (playersB.includes(player) && !aWon);
                    if (won) playerStats[player].wins++;
                });
            });
            
            return playerStats;
        }

        function calculatePlayerRanks(playerName, allPlayerStats) {
            const players = Object.keys(allPlayerStats);
            
            const sortedByWins = [...players].sort((a, b) => allPlayerStats[b].wins - allPlayerStats[a].wins);
            const sortedByMatches = [...players].sort((a, b) => allPlayerStats[b].matches - allPlayerStats[a].matches);
            const sortedByWinRate = [...players].sort((a, b) => {
                const rateA = allPlayerStats[a].matches > 0 ? allPlayerStats[a].wins / allPlayerStats[a].matches : 0;
                const rateB = allPlayerStats[b].matches > 0 ? allPlayerStats[b].wins / allPlayerStats[b].matches : 0;
                return rateB - rateA;
            });
            const sortedByDuration = [...players].sort((a, b) => allPlayerStats[b].duration - allPlayerStats[a].duration);
            
            return {
                wins: sortedByWins.indexOf(playerName) + 1,
                matches: sortedByMatches.indexOf(playerName) + 1,
                winRate: sortedByWinRate.indexOf(playerName) + 1,
                duration: sortedByDuration.indexOf(playerName) + 1
            };
        }

        function generateRealTags(wins, matches, winRate, totalDuration, maxWinStreak) {
            const tags = [];
            
            if (winRate >= 70 && matches >= 5) tags.push('🏆 常胜将军');
            if (winRate >= 50 && winRate < 70 && matches >= 5) tags.push('📈 稳定选手');
            if (matches >= 20) tags.push('🎯 球场老将');
            if (matches >= 50) tags.push('💪 资深玩家');
            if (totalDuration >= 36000) tags.push('⏱️ 运动达人');
            if (maxWinStreak >= 5) tags.push('🔥 连胜王者');
            if (maxWinStreak >= 3) tags.push('✨ 势不可挡');
            if (winRate >= 80 && matches >= 10) tags.push('👑 羽坛高手');
            if (matches >= 5 && matches < 10) tags.push('🌱 新秀选手');
            
            return tags;
        }

        /**
         * 切换排行榜类型
         * @param {string} type - 排行榜类型
         */
        function switchLeaderboard(type) {
            currentLeaderboardType = type;
            
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.tab-item[data-type="${type}"]`).classList.add('active');
            
            renderLeaderboard();
        }

        /**
         * 渲染排行榜
         */
        function renderLeaderboard() {
            const matchHistory = JSON.parse(localStorage.getItem('matchHistory') || '[]');
            const leaderboardList = document.getElementById('leaderboard-list');
            const topThreeSection = document.getElementById('top-three-section');
            
            if (matchHistory.length === 0) {
                topThreeSection.innerHTML = '';
                leaderboardList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🏸</div>
                        <p>暂无数据</p>
                        <p class="empty-state-hint">开始比赛后会自动生成排行榜</p>
                    </div>`;
                return;
            }

            const playerStats = {};
            
            matchHistory.forEach(match => {
                const playersA = match.teamA.split(/[\/、]/).map(p => p.trim());
                const playersB = match.teamB.split(/[\/、]/).map(p => p.trim());
                
                const aWon = match.scoreA > match.scoreB;
                
                playersA.forEach(player => {
                    if (!playerStats[player]) {
                        playerStats[player] = { wins: 0, matches: 0, duration: 0 };
                    }
                    playerStats[player].matches++;
                    playerStats[player].duration += match.duration || 0;
                    if (aWon) playerStats[player].wins++;
                });
                
                playersB.forEach(player => {
                    if (!playerStats[player]) {
                        playerStats[player] = { wins: 0, matches: 0, duration: 0 };
                    }
                    playerStats[player].matches++;
                    playerStats[player].duration += match.duration || 0;
                    if (!aWon) playerStats[player].wins++;
                });
            });

            const sortedPlayers = Object.entries(playerStats).map(([name, stats]) => ({
                name,
                ...stats,
                winRate: stats.matches > 0 ? (stats.wins / stats.matches * 100) : 0
            }));

            switch (currentLeaderboardType) {
                case 'wins':
                    sortedPlayers.sort((a, b) => b.wins - a.wins);
                    break;
                case 'matches':
                    sortedPlayers.sort((a, b) => b.matches - a.matches);
                    break;
                case 'winrate':
                    sortedPlayers.sort((a, b) => b.winRate - a.winRate);
                    break;
                case 'duration':
                    sortedPlayers.sort((a, b) => b.duration - a.duration);
                    break;
            }

            const top3 = sortedPlayers.slice(0, 3);
            const rest = sortedPlayers.slice(3, 10);

            if (top3.length > 0) {
                const order = [1, 0, 2];
                const cards = [];
                
                for (let i = 0; i < 3; i++) {
                    const idx = order[i];
                    if (top3[idx]) {
                        const player = top3[idx];
                        const cardClass = idx === 0 ? 'gold' : idx === 1 ? 'silver' : 'bronze';
                        const medal = idx === 0 ? '🥇' : idx === 1 ? '🥈' : '🥉';
                        
                        let displayValue = '';
                        let statsText = '';
                        
                        switch (currentLeaderboardType) {
                            case 'wins':
                                displayValue = player.wins + '胜';
                                statsText = `${player.matches}场 · ${Math.round(player.winRate)}%`;
                                break;
                            case 'matches':
                                displayValue = player.matches + '场';
                                statsText = `${player.wins}胜 · ${Math.round(player.winRate)}%`;
                                break;
                            case 'winrate':
                                displayValue = Math.round(player.winRate) + '%';
                                statsText = `${player.wins}胜/${player.matches}场`;
                                break;
                            case 'duration':
                                const hours = Math.floor(player.duration / 3600);
                                const minutes = Math.floor((player.duration % 3600) / 60);
                                displayValue = hours > 0 ? `${hours}h${minutes}m` : `${minutes}分钟`;
                                statsText = `${player.matches}场 · ${player.wins}胜`;
                                break;
                        }
                        
                        cards.push(`
                            <div class="top-player-card ${cardClass}">
                                <div class="top-rank-badge">${medal}</div>
                                <div class="top-player-name">${player.name}</div>
                                <div class="top-player-value">${displayValue}</div>
                                <div class="top-player-stats">${statsText}</div>
                            </div>
                        `);
                    }
                }
                
                topThreeSection.innerHTML = cards.join('');
            } else {
                topThreeSection.innerHTML = '';
            }

            if (rest.length > 0) {
                leaderboardList.innerHTML = rest.map((player, index) => {
                    let displayValue = '';
                    let statsText = '';
                    
                    switch (currentLeaderboardType) {
                        case 'wins':
                            displayValue = player.wins + '胜';
                            statsText = `${player.matches}场 · ${Math.round(player.winRate)}%`;
                            break;
                        case 'matches':
                            displayValue = player.matches + '场';
                            statsText = `${player.wins}胜 · ${Math.round(player.winRate)}%`;
                            break;
                        case 'winrate':
                            displayValue = Math.round(player.winRate) + '%';
                            statsText = `${player.wins}胜/${player.matches}场`;
                            break;
                        case 'duration':
                            const hours = Math.floor(player.duration / 3600);
                            const minutes = Math.floor((player.duration % 3600) / 60);
                            displayValue = hours > 0 ? `${hours}h${minutes}m` : `${minutes}分钟`;
                            statsText = `${player.matches}场 · ${player.wins}胜`;
                            break;
                    }

                    const rank = index + 4;
                    let rankClass = '';

                    return `
                        <div class="leaderboard-item">
                            <div class="leaderboard-rank ${rankClass}">${rank}</div>
                            <div class="leaderboard-info">
                                <div class="player-avatar-small">${getPlayerAvatar(player.name)}</div>
                                <div>
                                    <div class="leaderboard-name">${player.name}</div>
                                    <div style="font-size: 0.8rem; color: #6839E8; opacity: 0.7;">${statsText}</div>
                                </div>
                            </div>
                            <div class="leaderboard-value">${displayValue}</div>
                        </div>
                    `;
                }).join('');
            } else {
                leaderboardList.innerHTML = '<div style="text-align: center; color: #6839E8; opacity: 0.6; padding: 20px;">暂无更多数据</div>';
            }
        }

        /* ==================== 新手引导功能 ==================== */
        function initOnboarding() {
            const hasSeenOnboarding = localStorage.getItem('hasSeenOnboarding');
            if (!hasSeenOnboarding) {
                showOnboarding();
            }
        }

        function showOnboarding() {
            const overlay = document.createElement('div');
            overlay.className = 'onboarding-overlay';
            overlay.id = 'onboarding-overlay';
            overlay.innerHTML = `
                <div class="onboarding-modal">
                    <div class="onboarding-slides" id="onboarding-slides">
                        <div class="onboarding-slide active">
                            <div class="slide-icon">🏸</div>
                            <h2 class="slide-title">欢迎使用羽毛球极速计分板</h2>
                            <p class="slide-desc">专业、简洁、极速的羽毛球比赛计分工具</p>
                        </div>
                        <div class="onboarding-slide">
                            <div class="slide-icon">⚡</div>
                            <h2 class="slide-title">快速计分</h2>
                            <p class="slide-desc">点击大圆圈或+按钮即可加分，支持撤销操作</p>
                        </div>
                        <div class="onboarding-slide">
                            <div class="slide-icon">👥</div>
                            <h2 class="slide-title">智能分组</h2>
                            <p class="slide-desc">输入选手名单，自动生成公平的对战分组</p>
                        </div>
                        <div class="onboarding-slide">
                            <div class="slide-icon">💰</div>
                            <h2 class="slide-title">费用分摊</h2>
                            <p class="slide-desc">支持多种分摊模式，自动计算每人应付金额</p>
                        </div>
                        <div class="onboarding-slide">
                            <div class="slide-icon">📊</div>
                            <h2 class="slide-title">数据统计</h2>
                            <p class="slide-desc">自动记录比赛历史，生成排行榜和成就</p>
                        </div>
                        <div class="onboarding-slide">
                            <div class="slide-icon">🎉</div>
                            <h2 class="slide-title">开始体验</h2>
                            <p class="slide-desc">点击下方按钮，开启你的羽毛球计分之旅</p>
                        </div>
                    </div>
                    <div class="onboarding-dots" id="onboarding-dots"></div>
                    <div class="onboarding-actions">
                        <button class="btn-skip" onclick="skipOnboarding()">跳过</button>
                        <button class="btn-next" id="btn-next" onclick="nextSlide()">下一步</button>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            
            createDots();
        }

        let currentSlide = 0;
        const totalSlides = 6;

        function createDots() {
            const dotsContainer = document.getElementById('onboarding-dots');
            for (let i = 0; i < totalSlides; i++) {
                const dot = document.createElement('div');
                dot.className = `dot ${i === 0 ? 'active' : ''}`;
                dotsContainer.appendChild(dot);
            }
        }

        function nextSlide() {
            currentSlide++;
            if (currentSlide >= totalSlides) {
                completeOnboarding();
                return;
            }
            
            const slides = document.querySelectorAll('.onboarding-slide');
            const dots = document.querySelectorAll('.onboarding-dots .dot');
            
            slides.forEach((slide, index) => {
                slide.classList.toggle('active', index === currentSlide);
            });
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
            
            if (currentSlide === totalSlides - 1) {
                document.getElementById('btn-next').textContent = '开始使用';
            }
        }

        function skipOnboarding() {
            completeOnboarding();
        }

        function completeOnboarding() {
            localStorage.setItem('hasSeenOnboarding', 'true');
            const overlay = document.getElementById('onboarding-overlay');
            if (overlay) {
                overlay.classList.add('fade-out');
                setTimeout(() => overlay.remove(), 300);
            }
        }

        /* ==================== 快捷操作功能 ==================== */
        function showQuickActions() {
            const quickPanel = document.createElement('div');
            quickPanel.className = 'quick-actions-panel';
            quickPanel.id = 'quick-actions-panel';
            quickPanel.innerHTML = `
                <div class="quick-actions-content">
                    <div class="quick-action-item" onclick="quickAction('newMatch')">
                        <span class="quick-icon">🏸</span>
                        <span class="quick-label">新比赛</span>
                    </div>
                    <div class="quick-action-item" onclick="quickAction('randomTeam')">
                        <span class="quick-icon">🎲</span>
                        <span class="quick-label">随机分组</span>
                    </div>
                    <div class="quick-action-item" onclick="quickAction('splitCost')">
                        <span class="quick-icon">💰</span>
                        <span class="quick-label">费用分摊</span>
                    </div>
                    <div class="quick-action-item" onclick="quickAction('viewStats')">
                        <span class="quick-icon">📊</span>
                        <span class="quick-label">查看统计</span>
                    </div>
                </div>
            `;
            document.body.appendChild(quickPanel);
            
            setTimeout(() => quickPanel.classList.add('show'), 10);
            
            setTimeout(() => {
                quickPanel.classList.remove('show');
                setTimeout(() => quickPanel.remove(), 300);
            }, 3000);
        }

        function quickAction(action) {
            const panel = document.getElementById('quick-actions-panel');
            if (panel) {
                panel.classList.remove('show');
                setTimeout(() => panel.remove(), 300);
            }
            
            switch(action) {
                case 'newMatch':
                    switchScreen('scoreboard');
                    resetMatch();
                    break;
                case 'randomTeam':
                    switchScreen('grouping');
                    break;
                case 'splitCost':
                    switchScreen('expense');
                    break;
                case 'viewStats':
                    switchScreen('history');
                    break;
            }
        }

        // 双击屏幕显示快捷操作
        let lastTap = 0;
        document.addEventListener('touchend', function(e) {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            if (tapLength < 300 && tapLength > 0) {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'BUTTON') {
                    showQuickActions();
                }
            }
            lastTap = currentTime;
        });

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initOnboarding();
        });
    </script>
</body>
</html>